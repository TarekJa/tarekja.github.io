<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="احسب عمرك بشكل مباشر بالسنوات والأشهر والأيام والساعات والدقائق والثواني.">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0f172a">

  <link rel="canonical" href="https://tarekja.github.io/">
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon-512.png">

  <meta property="og:title" content="Live Age Calculator | حاسبة العمر المباشر">
  <meta property="og:description" content="احسب عمرك بشكل مباشر بالسنوات والأشهر والأيام والساعات والدقائق والثواني.">
  <meta property="og:url" content="https://tarekja.github.io/">
  <meta property="og:type" content="website">

  <!-- Google Analytics (مرة واحدة فقط) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ91MD319E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FZ91MD319E', { anonymize_ip: true });
  </script>

  <!-- Google AdSense -->
  <meta name="google-adsense-account" content="ca-pub-3878960602510145">
  <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3878960602510145"
          crossorigin="anonymous"></script>

  <title>Live Age Calculator | حاسبة العمر المباشر</title>

  <style>
    :root{
      --bg:#0f172a;
      --panel:#020617;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --line:#1e293b;
      color-scheme: dark;
    }

    body{
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin:0;
      padding:0;
    }

    .page{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 18px 10px;
    }

    .container{
      width: min(760px, 94vw);
      margin: 0 auto;
    }

    .box{
      background: var(--panel);
      padding: 22px;
      border-radius:16px;
      box-shadow:0 0 40px rgba(0,0,0,0.7);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }

    .lang-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 13px;
    }

    select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      outline:none;
      cursor:pointer;
    }
    option{
      background: #0b1220;
      color: var(--text);
    }

    h1{
      text-align:center;
      margin:0 0 14px 0;
      font-size:22px;
      color: var(--accent);
    }

    .subnote{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin: -4px 0 14px 0;
      line-height: 1.55;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 12px;
    }
    @media (max-width: 720px){
      .grid{ grid-template-columns: 1fr; }
    }

    .field{ margin-bottom: 12px; }

    label{
      display:block;
      margin-bottom:5px;
      color: var(--muted);
      font-size:14px;
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    input{
      width:100%;
      padding: 10px;
      border-radius:10px;
      border: 1px solid transparent;
      outline: none;
      font-size:14px;
      box-sizing: border-box;
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }
    input:focus{
      border-color: rgba(56,189,248,0.5);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.12);
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }

    button{
      flex:1;
      background: var(--accent);
      border:none;
      color:#0b1220;
      padding:10px 12px;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
      font-weight: bold;
    }
    button.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid var(--line);
      font-weight: normal;
    }
    button:hover{ opacity:0.92; }

    .result{
      margin-top:18px;
      display:none;
    }

    .card{
      background: rgba(2,6,23,0.45);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px 14px;
      margin-top: 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }

    .card-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }

    .card-title{
      font-weight:bold;
      font-size: 16px;
      color: var(--text);
    }

    .pill{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--line);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.03);
      white-space: nowrap;
    }

    .row{
      display:flex;
      justify-content:space-between;
      padding: 9px 0;
      border-bottom:1px dashed rgba(148,163,184,0.25);
      font-size:14px;
      gap: 16px;
    }
    .row:last-child{ border-bottom:none; }

    .label{ color: var(--muted); }
    .value{
      font-weight:bold;
      color: var(--text);
      text-align:left;
      white-space: nowrap;
    }
    /* لمنع بعثرة العربية مع الأرقام */
    .value[dir="rtl"]{
      text-align:left;
      unicode-bidi: plaintext;
    }
    .value[dir="ltr"]{
      direction:ltr;
    }

    .footer{
      margin-top: 16px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.7;
      text-align:center;
    }
    .footer a{ color: var(--accent); text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }

    details{
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(2,6,23,0.4);
      text-align: start;
    }
    summary{
      cursor: pointer;
      color: var(--text);
      font-weight: bold;
    }
    details p{
      margin: 10px 0 0 0;
      color: var(--muted);
      font-weight: normal;
    }

    .contact-meta{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--line);
      line-height: 1.9;
    }

    /* Share */
    .sharebar{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .shareBtn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--line);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: bold;
    }
    .shareBtn:hover{ background: rgba(255,255,255,0.08); }

    .shareIcon{
      width: 18px;
      height: 18px;
      display:inline-block;
    }

    .shareFallback{
      display:none;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .miniBtn{
      background: transparent;
      border: 1px solid var(--line);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: normal;
    }
    .miniBtn:hover{ background: rgba(255,255,255,0.06); }

    .toast{
      display:none;
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="box">

        <div class="topbar">
          <div class="lang-wrap">
            <span id="uiLangLabel">اللغة</span>
            <select id="langSelect" aria-label="Language selector">
              <option value="ar">العربية</option>
              <option value="tr">Türkçe</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>

        <h1 id="title">حاسبة العمر المباشر</h1>
        <div class="subnote" id="subnote">
          أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>
          (السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)
        </div>

        <div class="field">
          <label for="name" id="lblName">الاسم</label>
          <input type="text" id="name" placeholder="أدخل الاسم" maxlength="40">
          <div class="hint" id="hintName">اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.</div>
        </div>

        <div class="field">
          <label for="birthDate" id="lblBirthDate">تاريخ الميلاد</label>
          <input type="date" id="birthDate">
          <div class="hint" id="hintBirthDate">مطلوب. اختر التاريخ من التقويم.</div>
        </div>

        <div class="field">
          <label for="birthTime" id="lblBirthTime">ساعة الميلاد</label>
          <input type="time" id="birthTime" step="1">
          <div class="hint" id="hintBirthTime">
            اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>
            عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM) أو <b>19:30</b> (PM).
          </div>
          <div class="hint" id="timePreview"></div>
        </div>

        <div class="actions">
          <button id="btnStart" onclick="start()">احسب العمر</button>
          <button id="btnReset" class="secondary" onclick="resetApp()">مسح</button>
        </div>

        <!-- RESULTS -->
        <div class="result" id="result" aria-live="polite">

          <!-- Share -->
          <div class="sharebar">
            <button class="shareBtn" id="btnShare" type="button" onclick="shareNow()">
              <svg class="shareIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M18 8a3 3 0 1 0-2.83-4H15a3 3 0 0 0 .17 1l-7.2 4.1A3 3 0 0 0 6 8a3 3 0 1 0 1.97 5.26l7.2 4.1A3 3 0 0 0 15 18a3 3 0 1 0 .9-2.1l-7.2-4.1A3 3 0 0 0 9 11a3 3 0 0 0-.1-.8l7.2-4.1c.27.25.59.45.95.6A3 3 0 0 0 18 8Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="shareLabel">مشاركة</span>
            </button>
          </div>

          <div class="shareFallback" id="shareFallback">
            <button class="miniBtn" type="button" onclick="shareWhatsApp()">WhatsApp</button>
            <button class="miniBtn" type="button" onclick="shareFacebook()">Facebook</button>
            <button class="miniBtn" type="button" onclick="shareX()">X</button>
            <button class="miniBtn" type="button" onclick="copyShareLink()" id="copyBtn">Copy</button>
          </div>
          <div class="toast" id="toast">Copied</div>

          <!-- Live age -->
          <div class="card">
            <div class="card-head">
              <div class="card-title" id="liveAgeTitle">عمرك الآن</div>
            </div>

            <div class="row"><div class="label" id="rYears">السنوات (تقريب)</div><div class="value" id="years"></div></div>
            <div class="row"><div class="label" id="rMonths">الأشهر (تقريب)</div><div class="value" id="months"></div></div>
            <div class="row"><div class="label" id="rWeeks">الأسابيع</div><div class="value" id="weeks"></div></div>
            <div class="row"><div class="label" id="rDays">الأيام</div><div class="value" id="days"></div></div>
            <div class="row"><div class="label" id="rHours">الساعات</div><div class="value" id="hours"></div></div>
            <div class="row"><div class="label" id="rMinutes">الدقائق</div><div class="value" id="minutes"></div></div>
            <div class="row"><div class="label" id="rSeconds">الثواني</div><div class="value" id="seconds"></div></div>
          </div>

          <div class="grid">
            <!-- Next birthday -->
            <div class="card">
              <div class="card-head">
                <div class="card-title" id="nextBTitle">عيد ميلادك القادم</div>
                <div class="pill" id="tzPill">توقيت تركيا</div>
              </div>

              <div class="row">
                <div class="label" id="leftLbl">باقي لعيد ميلادك القادم:</div>
                <div class="value" id="leftVal"></div>
              </div>

              <div class="row">
                <div class="label" id="willBeLbl">سيكون عيد ميلادك يوم:</div>
                <div class="value" id="willBeVal"></div>
              </div>

              <div class="row">
                <div class="label" id="eqHijriLbl">الموافق:</div>
                <div class="value" id="eqHijriVal"></div>
              </div>
            </div>

            <!-- Hijri section -->
            <div class="card">
              <div class="card-head">
                <div class="card-title" id="hijriTitle">العمر حسب التقويم الهجري</div>
                <div class="pill">Umm al-Qura</div>
              </div>

              <div class="row">
                <div class="label" id="hBirthLbl">تاريخ الميلاد:</div>
                <div class="value" id="hBirthVal"></div>
              </div>

              <div class="row">
                <div class="label" id="hMonthLbl">شهر الميلاد:</div>
                <div class="value" id="hMonthVal"></div>
              </div>

              <div class="row">
                <div class="label" id="hAgeLbl">العمر:</div>
                <div class="value" id="hAgeVal"></div>
              </div>

              <div class="hint" id="hNote" style="margin-top:10px;"></div>
            </div>
          </div>

          <!-- More info -->
          <div class="card">
            <div class="card-head">
              <div class="card-title" id="moreTitle">معلومات أكثر عن عمرك</div>
            </div>

            <div class="row">
              <div class="label" id="bornDayLbl">ولدت يوم:</div>
              <div class="value" id="bornDayVal"></div>
            </div>

            <div class="row">
              <div class="label" id="bornSeasonLbl">ولدت في فصل:</div>
              <div class="value" id="bornSeasonVal"></div>
            </div>

            <div class="row">
              <div class="label" id="zodiacLbl">برجك:</div>
              <div class="value" id="zodiacVal"></div>
            </div>

            <div class="row">
              <div class="label" id="sleepLbl">نومك الصحي:</div>
              <div class="value" id="sleepVal"></div>
            </div>
          </div>

          <div class="footer">
            <div>
              <span id="usefulLinks">روابط مفيدة:</span>
              <a href="#about" onclick="openDetails('about')" id="lnkAbout">من نحن</a> ·
              <a href="/privacy.html" id="lnkPrivacy">سياسة الخصوصية</a> ·
              <a href="#contact" onclick="openDetails('contact')" id="lnkContact">تواصل</a>
            </div>

            <details id="about">
              <summary id="sumAbout">من نحن</summary>
              <p id="aboutText">
                هذه أداة بسيطة لحساب العمر بشكل مباشر عبر إدخال تاريخ ووقت الميلاد. تعمل بسلاسة على الجوال والكمبيوتر.
              </p>
            </details>

            <details id="contact">
              <summary id="sumContact">تواصل</summary>
              <p id="contactIntro">إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:</p>

              <div class="contact-meta">
                <div><b id="cNameLbl">الاسم:</b> <span id="cNameVal">Tarek Jawish</span></div>
                <div><b id="cRoleLbl">الصفة:</b> <span id="cRoleVal">MEAL Expert</span></div>
                <div><b id="cEmailLbl">البريد:</b> <a href="mailto:tarekjawish89@gmail.com">tarekjawish89@gmail.com</a></div>
                <div><b id="cLinkedLbl">LinkedIn:</b>
                  <a href="https://www.linkedin.com/in/tarek-jawish-890998106/" target="_blank" rel="noopener noreferrer" id="cLinkedText">
                    الملف الشخصي
                  </a>
                </div>
              </div>
            </details>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    let interval = null;
    let birthdayInterval = null;

    const TZ = "Europe/Istanbul";
    const STORAGE_KEYS = {
      name: "lac_name",
      date: "lac_birthDate",
      time: "lac_birthTime",
      lang: "lac_lang"
    };

    function $(id){ return document.getElementById(id); }

    function openDetails(id){
      const el = $(id);
      if (el && el.tagName.toLowerCase() === "details"){
        el.open = true;
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function saveInputs(){
      localStorage.setItem(STORAGE_KEYS.name, $("name").value || "");
      localStorage.setItem(STORAGE_KEYS.date, $("birthDate").value || "");
      localStorage.setItem(STORAGE_KEYS.time, $("birthTime").value || "");
    }

    function restoreInputs(){
      $("name").value = localStorage.getItem(STORAGE_KEYS.name) || "";
      $("birthDate").value = localStorage.getItem(STORAGE_KEYS.date) || "";
      $("birthTime").value = localStorage.getItem(STORAGE_KEYS.time) || "";
    }

    // ===== Hijri month names (Umm al-Qura) =====
    const HIJRI_MONTHS = {
      ar: ["محرم","صفر","ربيع الأول","ربيع الآخر","جمادى الأولى","جمادى الآخرة","رجب","شعبان","رمضان","شوال","ذو القعدة","ذو الحجة"],
      en: ["Muharram","Safar","Rabi' al-Awwal","Rabi' al-Thani","Jumada al-Ula","Jumada al-Akhirah","Rajab","Sha'ban","Ramadan","Shawwal","Dhu al-Qi'dah","Dhu al-Hijjah"],
      tr: ["Muharrem","Safer","Rebiülevvel","Rebiülahir","Cemaziyelevvel","Cemaziyelahir","Recep","Şaban","Ramazan","Şevval","Zilkade","Zilhicce"]
    };

    // ====== I18N ======
    const I18N = {
      ar: {
        uiLang: "اللغة",
        titleBase: "حاسبة العمر المباشر",
        subnote: `أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>(السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)`,
        lblName: "الاسم",
        phName: "أدخل الاسم",
        hintName: "اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.",
        lblBirthDate: "تاريخ الميلاد",
        hintBirthDate: "مطلوب. اختر التاريخ من التقويم.",
        lblBirthTime: "ساعة الميلاد",
        hintBirthTime: `اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM) أو <b>19:30</b> (PM).`,
        btnStart: "احسب العمر",
        btnReset: "مسح",
        liveAgeTitle: "عمرك الآن",
        rYears: "السنوات (تقريب)",
        rMonths: "الأشهر (تقريب)",
        rWeeks: "الأسابيع",
        rDays: "الأيام",
        rHours: "الساعات",
        rMinutes: "الدقائق",
        rSeconds: "الثواني",
        shareLabel: "مشاركة",
        usefulLinks: "روابط مفيدة:",
        lnkAbout: "من نحن",
        lnkPrivacy: "سياسة الخصوصية",
        lnkContact: "تواصل",
        sumAbout: "من نحن",
        aboutText: "هذه أداة بسيطة لحساب العمر بشكل مباشر عبر إدخال تاريخ ووقت الميلاد. تعمل بسلاسة على الجوال والكمبيوتر.",
        sumContact: "تواصل",
        contactIntro: "إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:",
        cNameLbl: "الاسم:",
        cRoleLbl: "الصفة:",
        cEmailLbl: "البريد:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "الملف الشخصي",
        alertNeedDate: "يرجى إدخال تاريخ الميلاد",
        alertInvalid: "الرجاء التأكد من صحة تاريخ/وقت الميلاد",
        alertFuture: "تاريخ/وقت الميلاد لا يمكن أن يكون في المستقبل",
        timeEmpty: `سيتم اعتبار الوقت <b>00:00:00</b> إذا تركته فارغًا.`,
        titleFor: (name) => `العمر المباشر لـ ${name}`,
        tzPill: "توقيت تركيا",
        nextBTitle: "عيد ميلادك القادم",
        leftLbl: "باقي لعيد ميلادك القادم:",
        willBeLbl: "سيكون عيد ميلادك يوم:",
        eqHijriLbl: "الموافق:",
        hijriTitle: "العمر حسب التقويم الهجري",
        hBirthLbl: "تاريخ الميلاد:",
        hMonthLbl: "شهر الميلاد:",
        hAgeLbl: "العمر:",
        hijriSuffix: "هـ",
        hNote: "ملاحظة: يختلف العمر بالهجري عن الميلادي لأن السنة الهجرية حوالي 354.36 يومًا بينما السنة الميلادية حوالي 365.25 يومًا. لذلك يظهر فرق يقارب 11 يومًا لكل سنة، ويزداد هذا الفرق مع مرور الوقت.",
        moreTitle: "معلومات أكثر عن عمرك",
        bornDayLbl: "ولدت يوم:",
        bornSeasonLbl: "ولدت في فصل:",
        zodiacLbl: "برجك:",
        sleepLbl: "نومك الصحي:",
        sleepVal: "الموصى به تقريبًا: 7-9 ساعات",
        seasons: {spring:"الربيع", summer:"الصيف", autumn:"الخريف", winter:"الشتاء"},
        shareTemplate: (ageStr, hijriStr) => `جرّبها! عمري الآن: ${ageStr}\nالموافق بالهجري: ${hijriStr}`
      },
      en: {
        uiLang: "Language",
        titleBase: "Live Age Calculator",
        subnote: `Enter birth date and time, then watch your age update every second.<br>(Years/months are approximate — days/hours/minutes/seconds are exact)`,
        lblName: "Name",
        phName: "Enter name",
        hintName: "Optional. If empty, the general title will be shown without a name.",
        lblBirthDate: "Birth date",
        hintBirthDate: "Required. Choose the date from the calendar.",
        lblBirthTime: "Birth time",
        hintBirthTime: `Optional. If empty, time will be set to <b>00:00:00</b>.<br>Input is usually <b>24-hour</b> format: e.g., <b>07:30</b> (AM) or <b>19:30</b> (PM).`,
        btnStart: "Calculate",
        btnReset: "Clear",
        liveAgeTitle: "Your age now",
        rYears: "Years (approx.)",
        rMonths: "Months (approx.)",
        rWeeks: "Weeks",
        rDays: "Days",
        rHours: "Hours",
        rMinutes: "Minutes",
        rSeconds: "Seconds",
        shareLabel: "Share",
        usefulLinks: "Useful links:",
        lnkAbout: "About",
        lnkPrivacy: "Privacy Policy",
        lnkContact: "Contact",
        sumAbout: "About",
        aboutText: "A lightweight tool to calculate age in real time by entering birth date and time. Works smoothly on mobile and desktop.",
        sumContact: "Contact",
        contactIntro: "For suggestions or feedback, you can reach me via:",
        cNameLbl: "Name:",
        cRoleLbl: "Role:",
        cEmailLbl: "Email:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profile",
        alertNeedDate: "Please enter your birth date",
        alertInvalid: "Please check the birth date/time values",
        alertFuture: "Birth date/time cannot be in the future",
        timeEmpty: `If left empty, time will be set to <b>00:00:00</b>.`,
        titleFor: (name) => `Live age for ${name}`,
        tzPill: "Turkey time",
        nextBTitle: "Your next birthday",
        leftLbl: "Time left:",
        willBeLbl: "Your birthday will be on:",
        eqHijriLbl: "Hijri equivalent:",
        hijriTitle: "Age in Hijri calendar",
        hBirthLbl: "Birth date:",
        hMonthLbl: "Birth month:",
        hAgeLbl: "Age:",
        hijriSuffix: "AH",
        hNote: "Note: Hijri age differs from Gregorian age because the Hijri year is about 354.36 days while the Gregorian year is about 365.25 days. This creates an approximate 11-day difference per year, which grows over time.",
        moreTitle: "More about your age",
        bornDayLbl: "Born on:",
        bornSeasonLbl: "Born in season:",
        zodiacLbl: "Zodiac sign:",
        sleepLbl: "Healthy sleep:",
        sleepVal: "Recommended: ~7–9 hours",
        seasons: {spring:"Spring", summer:"Summer", autumn:"Autumn", winter:"Winter"},
        shareTemplate: (ageStr, hijriStr) => `Try it! My age now: ${ageStr}\nHijri equivalent: ${hijriStr}`
      },
      tr: {
        uiLang: "Dil",
        titleBase: "Canlı Yaş Hesaplayıcı",
        subnote: `Doğum tarihi ve saatini girin, yaşınız her saniye güncellensin.<br>(Yıl/ay yaklaşık — gün/saat/dakika/saniye kesin)`,
        lblName: "İsim",
        phName: "İsim girin",
        hintName: "İsteğe bağlı. Boş bırakırsanız genel başlık gösterilir.",
        lblBirthDate: "Doğum tarihi",
        hintBirthDate: "Gerekli. Takvimden tarih seçin.",
        lblBirthTime: "Doğum saati",
        hintBirthTime: `İsteğe bağlı. Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.<br>Giriş genelde <b>24 saat</b> formatıdır: örn. <b>07:30</b> (AM) veya <b>19:30</b> (PM).`,
        btnStart: "Hesapla",
        btnReset: "Temizle",
        liveAgeTitle: "Şu anki yaşınız",
        rYears: "Yıl (yaklaşık)",
        rMonths: "Ay (yaklaşık)",
        rWeeks: "Hafta",
        rDays: "Gün",
        rHours: "Saat",
        rMinutes: "Dakika",
        rSeconds: "Saniye",
        shareLabel: "Paylaş",
        usefulLinks: "Bağlantılar:",
        lnkAbout: "Hakkında",
        lnkPrivacy: "Gizlilik Politikası",
        lnkContact: "İletişim",
        sumAbout: "Hakkında",
        aboutText: "Doğum tarihi ve saatini girerek yaşınızı gerçek zamanlı hesaplayan hafif bir araç. Mobil ve masaüstünde sorunsuz çalışır.",
        sumContact: "İletişim",
        contactIntro: "Öneri veya geri bildirim için şu kanallardan ulaşabilirsiniz:",
        cNameLbl: "İsim:",
        cRoleLbl: "Unvan:",
        cEmailLbl: "E-posta:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profil",
        alertNeedDate: "Lütfen doğum tarihinizi girin",
        alertInvalid: "Lütfen doğum tarihi/saat değerlerini kontrol edin",
        alertFuture: "Doğum tarihi/saat gelecekte olamaz",
        timeEmpty: `Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.`,
        titleFor: (name) => `${name} için canlı yaş`,
        tzPill: "Türkiye saati",
        nextBTitle: "Bir sonraki doğum gününüz",
        leftLbl: "Kalan süre:",
        willBeLbl: "Doğum gününüz şu gün olacak:",
        eqHijriLbl: "Hicri karşılığı:",
        hijriTitle: "Hicri takvime göre yaş",
        hBirthLbl: "Doğum tarihi:",
        hMonthLbl: "Doğum ayı:",
        hAgeLbl: "Yaş:",
        hijriSuffix: "H",
        hNote: "Not: Hicri yaş, Miladi yaştan farklıdır çünkü Hicri yıl yaklaşık 354,36 gün; Miladi yıl ise yaklaşık 365,25 gündür. Bu da yılda yaklaşık 11 günlük fark oluşturur ve zamanla artar.",
        moreTitle: "Yaşınız hakkında daha fazla bilgi",
        bornDayLbl: "Doğduğunuz gün:",
        bornSeasonLbl: "Doğduğunuz mevsim:",
        zodiacLbl: "Burcunuz:",
        sleepLbl: "Sağlıklı uyku:",
        sleepVal: "Önerilen: ~7–9 saat",
        seasons: {spring:"İlkbahar", summer:"Yaz", autumn:"Sonbahar", winter:"Kış"},
        shareTemplate: (ageStr, hijriStr) => `Deneyin! Şu anki yaşım: ${ageStr}\nHicri karşılığı: ${hijriStr}`
      }
    };

    const LANG_META = {
      ar: { dir: "rtl", lang: "ar" },
      en: { dir: "ltr", lang: "en" },
      tr: { dir: "ltr", lang: "tr" }
    };

    let currentLang = "ar";

    function pickInitialLanguage(){
      const saved = localStorage.getItem(STORAGE_KEYS.lang);
      if (saved && I18N[saved]) return saved;

      const urlLang = new URLSearchParams(window.location.search).get("lang");
      if (urlLang && I18N[urlLang]) return urlLang;

      const langs = (navigator.languages && navigator.languages.length)
        ? navigator.languages
        : [navigator.language || "en"];

      const lc = langs.map(x => String(x).toLowerCase());
      if (lc.some(x => x.startsWith("ar"))) return "ar";
      if (lc.some(x => x.startsWith("tr"))) return "tr";
      return "en";
    }

    function setLanguage(lang){
      if (!I18N[lang]) lang = "ar";
      currentLang = lang;
      localStorage.setItem(STORAGE_KEYS.lang, lang);

      document.documentElement.lang = LANG_META[lang].lang;
      document.documentElement.dir = LANG_META[lang].dir;

      const t = I18N[lang];

      $("uiLangLabel").textContent = t.uiLang;
      $("title").textContent = t.titleBase;
      $("subnote").innerHTML = t.subnote;

      $("lblName").textContent = t.lblName;
      $("name").placeholder = t.phName;
      $("hintName").textContent = t.hintName;

      $("lblBirthDate").textContent = t.lblBirthDate;
      $("hintBirthDate").textContent = t.hintBirthDate;

      $("lblBirthTime").textContent = t.lblBirthTime;
      $("hintBirthTime").innerHTML = t.hintBirthTime;

      $("btnStart").textContent = t.btnStart;
      $("btnReset").textContent = t.btnReset;

      $("liveAgeTitle").textContent = t.liveAgeTitle;

      $("rYears").textContent = t.rYears;
      $("rMonths").textContent = t.rMonths;
      $("rWeeks").textContent = t.rWeeks;
      $("rDays").textContent = t.rDays;
      $("rHours").textContent = t.rHours;
      $("rMinutes").textContent = t.rMinutes;
      $("rSeconds").textContent = t.rSeconds;

      $("shareLabel").textContent = t.shareLabel;

      $("usefulLinks").textContent = t.usefulLinks;
      $("lnkAbout").textContent = t.lnkAbout;
      $("lnkPrivacy").textContent = t.lnkPrivacy;
      $("lnkContact").textContent = t.lnkContact;

      $("sumAbout").textContent = t.sumAbout;
      $("aboutText").textContent = t.aboutText;

      $("sumContact").textContent = t.sumContact;
      $("contactIntro").textContent = t.contactIntro;

      $("cNameLbl").textContent = t.cNameLbl;
      $("cRoleLbl").textContent = t.cRoleLbl;
      $("cEmailLbl").textContent = t.cEmailLbl;
      $("cLinkedLbl").textContent = t.cLinkedLbl;
      $("cLinkedText").textContent = t.cLinkedText;

      $("tzPill").textContent = t.tzPill;
      $("nextBTitle").textContent = t.nextBTitle;
      $("leftLbl").textContent = t.leftLbl;
      $("willBeLbl").textContent = t.willBeLbl;
      $("eqHijriLbl").textContent = t.eqHijriLbl;

      $("hijriTitle").textContent = t.hijriTitle;
      $("hBirthLbl").textContent = t.hBirthLbl;
      $("hMonthLbl").textContent = t.hMonthLbl;
      $("hAgeLbl").textContent = t.hAgeLbl;
      $("hNote").textContent = t.hNote;

      $("moreTitle").textContent = t.moreTitle;
      $("bornDayLbl").textContent = t.bornDayLbl;
      $("bornSeasonLbl").textContent = t.bornSeasonLbl;
      $("zodiacLbl").textContent = t.zodiacLbl;
      $("sleepLbl").textContent = t.sleepLbl;
      $("sleepVal").textContent = t.sleepVal;

      updateTimePreview();
      updateDynamicTitle();
      refreshComputedSections(); // لتحديث النصوص المحسوبة مع تغيير اللغة
    }

    function updateDynamicTitle(){
      const name = ($("name").value || "").trim();
      const t = I18N[currentLang];
      const isResultVisible = $("result").style.display === "block";

      if (!isResultVisible){
        $("title").textContent = t.titleBase;
        return;
      }
      $("title").textContent = name ? t.titleFor(name) : t.titleBase;
    }

    function updateTimePreview(){
      const preview = $("timePreview");
      if (!preview) return;

      const t = I18N[currentLang];
      const timeVal = ($("birthTime").value || "").trim();

      if (!timeVal){
        preview.innerHTML = t.timeEmpty;
        return;
      }

      const parts = timeVal.split(":").map(Number);
      const hh24 = parts[0] ?? 0;
      const mm = parts[1] ?? 0;

      const isPM = hh24 >= 12;
      let hh12 = hh24 % 12;
      if (hh12 === 0) hh12 = 12;

      const ampm = isPM ? "PM" : "AM";
      const mm2 = String(mm).padStart(2, "0");
      preview.textContent = `${timeVal} = ${hh12}:${mm2} ${ampm}`;
    }

    // ===== Timezone helpers (Turkey wall time) =====
    function tzParts(date, timeZone){
      const fmt = new Intl.DateTimeFormat("en-US", {
        timeZone,
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit", second:"2-digit",
        hour12:false
      });
      const parts = fmt.formatToParts(date);
      const out = {};
      for (const p of parts) out[p.type] = p.value;
      return {
        y: Number(out.year),
        m: Number(out.month),
        d: Number(out.day),
        hh: Number(out.hour),
        mm: Number(out.minute),
        ss: Number(out.second),
      };
    }

    function wallDateUTC(y,m,d,hh,mm,ss){
      return new Date(Date.UTC(y, m-1, d, hh||0, mm||0, ss||0));
    }

    function tzNowWallDate(timeZone){
      const p = tzParts(new Date(), timeZone);
      return wallDateUTC(p.y, p.m, p.d, p.hh, p.mm, p.ss);
    }

    function daysInMonthUTC(y, m){ // m: 1-12
      return new Date(Date.UTC(y, m, 0)).getUTCDate();
    }

    function addMonthsUTC(dateUTC, months){
      const y = dateUTC.getUTCFullYear();
      const m0 = dateUTC.getUTCMonth(); // 0-11
      const d = dateUTC.getUTCDate();
      const hh = dateUTC.getUTCHours();
      const mm = dateUTC.getUTCMinutes();
      const ss = dateUTC.getUTCSeconds();

      const targetM0 = m0 + months;
      const ny = y + Math.floor(targetM0 / 12);
      const nm0 = ((targetM0 % 12) + 12) % 12;
      const nm = nm0 + 1;
      const maxD = daysInMonthUTC(ny, nm);
      const nd = Math.min(d, maxD);
      return new Date(Date.UTC(ny, nm0, nd, hh, mm, ss));
    }

    function addDaysUTC(dateUTC, days){
      return new Date(dateUTC.getTime() + days * 86400000);
    }

    function diffCalendarUTC(fromUTC, toUTC){
      // returns {months, days, hours, minutes, seconds} exact by stepping months then days, remainder as time
      if (toUTC.getTime() < fromUTC.getTime()){
        return {months:0, days:0, hours:0, minutes:0, seconds:0};
      }

      let temp = new Date(fromUTC.getTime());
      let months = 0;
      while (true){
        const next = addMonthsUTC(temp, 1);
        if (next.getTime() <= toUTC.getTime()){
          temp = next; months++;
        } else break;
      }

      let days = 0;
      while (true){
        const nextD = addDaysUTC(temp, 1);
        if (nextD.getTime() <= toUTC.getTime()){
          temp = nextD; days++;
        } else break;
      }

      let remaining = Math.floor((toUTC.getTime() - temp.getTime()) / 1000);
      const hours = Math.floor(remaining / 3600); remaining -= hours*3600;
      const minutes = Math.floor(remaining / 60); remaining -= minutes*60;
      const seconds = remaining;

      return {months, days, hours, minutes, seconds};
    }

    function pad2(n){ return String(n).padStart(2,"0"); }

    function formatCountdown(dur, lang){
      const sep = " - ";
      if (lang === "ar"){
        // "شهر 1 - يوم 15 - ساعة 11 - دقيقة 8 - ثانية 3"
        const parts = [];
        if (dur.months) parts.push(`شهر ${dur.months}`);
        if (dur.days) parts.push(`يوم ${dur.days}`);
        parts.push(`ساعة ${dur.hours}`);
        parts.push(`دقيقة ${dur.minutes}`);
        parts.push(`ثانية ${dur.seconds}`);
        return parts.join(sep);
      }
      if (lang === "tr"){
        const parts = [];
        if (dur.months) parts.push(`${dur.months} ay`);
        if (dur.days) parts.push(`${dur.days} gün`);
        parts.push(`${dur.hours} saat`);
        parts.push(`${dur.minutes} dk`);
        parts.push(`${dur.seconds} sn`);
        return parts.join(sep);
      }
      // en
      const parts = [];
      if (dur.months) parts.push(`${dur.months} mo`);
      if (dur.days) parts.push(`${dur.days} d`);
      parts.push(`${dur.hours} h`);
      parts.push(`${dur.minutes} m`);
      parts.push(`${dur.seconds} s`);
      return parts.join(sep);
    }

    // ===== Hijri (Umm al-Qura) via Intl parts =====
    function getHijriParts(gregDate){
      // Use locale-agnostic numeric month, then map month names ourselves
      const loc = currentLang === "ar" ? "ar-SA" : (currentLang === "tr" ? "tr-TR" : "en-US");
      const fmt = new Intl.DateTimeFormat(loc + "-u-ca-islamic-umalqura", {
        day: "numeric",
        month: "numeric",
        year: "numeric"
      });
      const parts = fmt.formatToParts(gregDate);
      const out = {};
      for (const p of parts){
        if (p.type === "day" || p.type === "month" || p.type === "year") out[p.type] = p.value;
      }
      return {
        hy: Number(out.year),
        hm: Number(out.month),
        hd: Number(out.day)
      };
    }

    function hijriMonthName(hm){
      const list = HIJRI_MONTHS[currentLang] || HIJRI_MONTHS.ar;
      return list[Math.max(1, Math.min(12, hm)) - 1];
    }

    function formatHijriDate(hParts){
      const mName = hijriMonthName(hParts.hm);
      const suf = I18N[currentLang].hijriSuffix;
      if (currentLang === "ar"){
        return `${hParts.hd} ${mName} ${hParts.hy} ${suf}`;
      }
      if (currentLang === "tr"){
        return `${hParts.hd} ${mName} ${hParts.hy} ${suf}`;
      }
      return `${hParts.hd} ${mName} ${hParts.hy} ${suf}`;
    }

    function formatHijriAgeFromDays(diffDays){
      // Using the explanatory average lengths (matches the note)
      const hijriYearDays = 354.36;
      const hijriMonthDays = hijriYearDays / 12; // ~29.53

      const years = Math.floor(diffDays / hijriYearDays);
      let rem = diffDays - years * hijriYearDays;

      const months = Math.floor(rem / hijriMonthDays);
      rem -= months * hijriMonthDays;

      const days = Math.floor(rem);

      const sep = " - ";
      if (currentLang === "ar"){
        // keep word before number to avoid RTL break
        return `سنة ${years}${sep}شهر ${months}${sep}يوم ${days}`;
      }
      if (currentLang === "tr"){
        return `${years} yıl${sep}${months} ay${sep}${days} gün`;
      }
      return `${years} years${sep}${months} months${sep}${days} days`;
    }

    // ===== More info helpers =====
    function zodiacSign(m, d){
      // Western zodiac
      const z = [
        {name:{ar:"الجدي",en:"Capricorn",tr:"Oğlak"}, from:[12,22]},
        {name:{ar:"الدلو",en:"Aquarius",tr:"Kova"}, from:[1,20]},
        {name:{ar:"الحوت",en:"Pisces",tr:"Balık"}, from:[2,19]},
        {name:{ar:"الحمل",en:"Aries",tr:"Koç"}, from:[3,21]},
        {name:{ar:"الثور",en:"Taurus",tr:"Boğa"}, from:[4,20]},
        {name:{ar:"الجوزاء",en:"Gemini",tr:"İkizler"}, from:[5,21]},
        {name:{ar:"السرطان",en:"Cancer",tr:"Yengeç"}, from:[6,21]},
        {name:{ar:"الأسد",en:"Leo",tr:"Aslan"}, from:[7,23]},
        {name:{ar:"العذراء",en:"Virgo",tr:"Başak"}, from:[8,23]},
        {name:{ar:"الميزان",en:"Libra",tr:"Terazi"}, from:[9,23]},
        {name:{ar:"العقرب",en:"Scorpio",tr:"Akrep"}, from:[10,23]},
        {name:{ar:"القوس",en:"Sagittarius",tr:"Yay"}, from:[11,22]},
      ];
      for (let i = z.length-1; i>=0; i--){
        const [fm, fd] = z[i].from;
        if (m > fm || (m === fm && d >= fd)) return z[i].name[currentLang];
      }
      return z[0].name[currentLang];
    }

    function seasonFor(m, d){
      // Northern hemisphere (Turkey)
      // Spring: Mar 20 - Jun 20, Summer: Jun 21 - Sep 22, Autumn: Sep 23 - Dec 20, Winter: Dec 21 - Mar 19
      const s = I18N[currentLang].seasons;
      if ((m === 3 && d >= 20) || (m > 3 && m < 6) || (m === 6 && d <= 20)) return s.spring;
      if ((m === 6 && d >= 21) || (m > 6 && m < 9) || (m === 9 && d <= 22)) return s.summer;
      if ((m === 9 && d >= 23) || (m > 9 && m < 12) || (m === 12 && d <= 20)) return s.autumn;
      return s.winter;
    }

    function formatDateTimeInTZ(dateUTCWall){
      // dateUTCWall is wall-time-in-UTC (constructed by wallDateUTC)
      // We can format it as if it's in UTC but show as "Turkey time"
      const loc = currentLang === "ar" ? "ar" : (currentLang === "tr" ? "tr" : "en");
      return new Intl.DateTimeFormat(loc, {
        weekday:"long", year:"numeric", month:"long", day:"numeric",
        hour:"2-digit", minute:"2-digit",
        hour12: currentLang === "en" ? true : false,
        timeZone: "UTC" // since it's already wall-time stored in UTC
      }).format(dateUTCWall);
    }

    function formatWeekdayInTZ(dateUTCWall){
      const loc = currentLang === "ar" ? "ar" : (currentLang === "tr" ? "tr" : "en");
      return new Intl.DateTimeFormat(loc, {
        weekday:"long",
        timeZone:"UTC"
      }).format(dateUTCWall);
    }

    // ===== share helpers =====
    function buildShareURL(){
      const base = "https://tarekja.github.io/";
      const d = $("birthDate").value || "";
      const t = $("birthTime").value || "";
      const n = ($("name").value || "").trim();

      const params = new URLSearchParams();
      if (d) params.set("d", d);
      if (t) params.set("t", t);
      if (n) params.set("n", n);
      params.set("lang", currentLang);

      return base + (params.toString() ? ("?" + params.toString()) : "");
    }

    function getShareSummary(){
      // Use a short age string: days - hours - minutes - seconds (most meaningful for share)
      const days = $("days").textContent || "0";
      const hours = $("hours").textContent || "0";
      const minutes = $("minutes").textContent || "0";
      const seconds = $("seconds").textContent || "0";

      const sep = " - ";
      let ageStr = "";
      if (currentLang === "ar"){
        ageStr = `يوم ${days}${sep}ساعة ${hours}${sep}دقيقة ${minutes}${sep}ثانية ${seconds}`;
      } else if (currentLang === "tr"){
        ageStr = `${days} gün${sep}${hours} saat${sep}${minutes} dk${sep}${seconds} sn`;
      } else {
        ageStr = `${days} d${sep}${hours} h${sep}${minutes} m${sep}${seconds} s`;
      }

      const hijriStr = $("eqHijriVal").textContent || $("hBirthVal").textContent || "";
      const text = I18N[currentLang].shareTemplate(ageStr, hijriStr);
      return { text, url: buildShareURL() };
    }

    async function shareNow(){
      const { text, url } = getShareSummary();

      if (navigator.share){
        try{
          await navigator.share({
            title: I18N[currentLang].titleBase,
            text,
            url
          });
          return;
        }catch(e){
          // if user cancels -> do nothing
        }
      }

      // fallback bar
      $("shareFallback").style.display = "flex";
      // small toast reset
      $("toast").style.display = "none";
    }

    function shareWhatsApp(){
      const { text, url } = getShareSummary();
      const full = encodeURIComponent(text + "\n" + url);
      window.open("https://wa.me/?text=" + full, "_blank");
    }

    function shareFacebook(){
      const { url } = getShareSummary();
      window.open("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(url), "_blank");
    }

    function shareX(){
      const { text, url } = getShareSummary();
      const full = encodeURIComponent(text);
      window.open("https://twitter.com/intent/tweet?text=" + full + "&url=" + encodeURIComponent(url), "_blank");
    }

    async function copyShareLink(){
      const { url } = getShareSummary();
      const t = $("toast");
      try{
        await navigator.clipboard.writeText(url);
        t.textContent = (currentLang === "ar") ? "تم نسخ الرابط" : (currentLang === "tr" ? "Bağlantı kopyalandı" : "Link copied");
        t.style.display = "block";
        setTimeout(()=> t.style.display="none", 1800);
      }catch(e){
        t.textContent = url;
        t.style.display = "block";
      }
    }

    // ====== App logic ======
    function buildLocalDate(dateStr, timeStr){
      const parts = (dateStr || "").split("-").map(Number);
      if (parts.length !== 3 || parts.some(Number.isNaN)) return null;

      const t = (timeStr && timeStr.trim()) ? timeStr.trim() : "00:00:00";
      const tParts = t.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mm = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      const y = parts[0], m = parts[1], d = parts[2];
      const dt = new Date(y, m - 1, d, hh, mm, ss);
      if (Number.isNaN(dt.getTime())) return null;
      return dt;
    }

    function resetApp(){
      if (interval) { clearInterval(interval); interval = null; }
      if (birthdayInterval) { clearInterval(birthdayInterval); birthdayInterval = null; }

      $("result").style.display = "none";
      ["years","months","weeks","days","hours","minutes","seconds"].forEach(id => $(id).textContent = "");

      ["leftVal","willBeVal","eqHijriVal","hBirthVal","hMonthVal","hAgeVal","bornDayVal","bornSeasonVal","zodiacVal"].forEach(id=>{
        if ($(id)) $(id).textContent = "";
      });

      $("shareFallback").style.display = "none";
      $("toast").style.display = "none";

      $("name").value = "";
      $("birthDate").value = "";
      $("birthTime").value = "";

      localStorage.removeItem(STORAGE_KEYS.name);
      localStorage.removeItem(STORAGE_KEYS.date);
      localStorage.removeItem(STORAGE_KEYS.time);

      updateTimePreview();
      setLanguage(currentLang);
    }

    function refreshComputedSections(){
      // Reformat values that depend on language after language switch
      // If results visible, recompute next birthday/hijri/more info quickly.
      if ($("result").style.display !== "block") return;
      const date = $("birthDate").value;
      if (!date) return;
      // trigger one update tick by calling helpers
      try{
        computeExtraSections();
      }catch(e){}
    }

    function computeExtraSections(){
      // Uses birth inputs and Turkey time
      const date = $("birthDate").value;
      const time = $("birthTime").value || "00:00:00";

      const parts = date.split("-").map(Number);
      const y = parts[0], m = parts[1], d = parts[2];

      const tParts = time.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mi = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      // Turkey wall now
      const nowTR = tzNowWallDate(TZ);

      // Next birthday wall date
      let targetY = nowTR.getUTCFullYear();
      let targetM = m;
      let targetD = d;

      // handle Feb 29
      const isLeap = (yr) => (yr%4===0 && (yr%100!==0 || yr%400===0));
      if (m === 2 && d === 29 && !isLeap(targetY)) targetD = 28;

      let nextB = wallDateUTC(targetY, targetM, targetD, hh, mi, ss);
      if (nextB.getTime() <= nowTR.getTime()){
        targetY += 1;
        targetD = d;
        if (m === 2 && d === 29 && !isLeap(targetY)) targetD = 28;
        nextB = wallDateUTC(targetY, targetM, targetD, hh, mi, ss);
      }

      // Countdown (calendar exact)
      const dur = diffCalendarUTC(nowTR, nextB);
      $("leftVal").textContent = formatCountdown(dur, currentLang);

      // Birthday will be on
      $("willBeVal").textContent = formatDateTimeInTZ(nextB);

      // Hijri equivalent of next birthday
      const hNext = getHijriParts(new Date(nextB.getTime())); // use as gregorian instant
      const hNextStr = formatHijriDate(hNext);
      $("eqHijriVal").textContent = hNextStr;

      // Hijri birth date
      const birthLocal = buildLocalDate(date, time);
      // We want Hijri parts based on the birth "civil date" (local). This is acceptable for the feature.
      const hBirth = getHijriParts(birthLocal);
      $("hBirthVal").textContent = formatHijriDate(hBirth);
      $("hMonthVal").textContent = hijriMonthName(hBirth.hm);

      // Hijri age from days diff (using the same rationale as the note)
      const diffDays = Math.floor((Date.now() - birthLocal.getTime()) / 86400000);
      const hijriAgeStr = formatHijriAgeFromDays(diffDays);

      // Apply correct dir to avoid RTL breaks
      if (currentLang === "ar"){
        $("hAgeVal").setAttribute("dir","rtl");
      } else {
        $("hAgeVal").setAttribute("dir","ltr");
      }
      $("hAgeVal").textContent = hijriAgeStr;

      // More info
      // Build a Turkey-wall date for birth for consistent weekday display:
      const birthWall = wallDateUTC(y, m, d, hh, mi, ss);

      $("bornDayVal").textContent = formatWeekdayInTZ(birthWall);
      $("bornSeasonVal").textContent = seasonFor(m, d);
      $("zodiacVal").textContent = zodiacSign(m, d);
    }

    function start(){
      const t = I18N[currentLang];

      const name = ($("name").value || "").trim();
      const date = $("birthDate").value;
      const time = $("birthTime").value || "00:00:00";

      if (!date){
        alert(t.alertNeedDate);
        return;
      }

      const birthDate = buildLocalDate(date, time);
      if (!birthDate){
        alert(t.alertInvalid);
        return;
      }

      if (birthDate.getTime() > Date.now()){
        alert(t.alertFuture);
        return;
      }

      saveInputs();

      $("result").style.display = "block";
      updateDynamicTitle();

      // Clear prior intervals
      if (interval) clearInterval(interval);
      if (birthdayInterval) clearInterval(birthdayInterval);

      function updateLiveAge(){
        const now = Date.now();
        let diffMs = now - birthDate.getTime();
        if (diffMs < 0) diffMs = 0;

        const seconds = Math.floor(diffMs / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours   = Math.floor(minutes / 60);
        const days    = Math.floor(hours / 24);
        const weeks   = Math.floor(days / 7);

        const yearsApprox  = diffMs / (1000 * 60 * 60 * 24 * 365.2425);
        const monthsApprox = yearsApprox * 12;

        $("years").textContent    = yearsApprox.toFixed(6);
        $("months").textContent   = monthsApprox.toFixed(2);
        $("weeks").textContent    = weeks.toLocaleString();
        $("days").textContent     = days.toLocaleString();
        $("hours").textContent    = hours.toLocaleString();
        $("minutes").textContent  = minutes.toLocaleString();
        $("seconds").textContent  = seconds.toLocaleString();
      }

      // extra sections (next birthday, hijri, more info)
      function updateExtras(){
        computeExtraSections();
      }

      updateLiveAge();
      updateExtras();

      interval = setInterval(updateLiveAge, 1000);
      birthdayInterval = setInterval(updateExtras, 1000);
    }

    // Restore from share URL params (optional)
    function applyURLParams(){
      const qs = new URLSearchParams(window.location.search);
      const d = qs.get("d");
      const tt = qs.get("t");
      const n = qs.get("n");
      const lang = qs.get("lang");

      if (lang && I18N[lang]){
        currentLang = lang;
        localStorage.setItem(STORAGE_KEYS.lang, lang);
      }

      if (n) $("name").value = n;
      if (d) $("birthDate").value = d;
      if (tt) $("birthTime").value = tt;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date().toISOString().split("T")[0];
      $("birthDate").setAttribute("max", today);

      // Restore storage first
      restoreInputs();

      // Apply URL params (if any)
      applyURLParams();

      // Language auto
      currentLang = pickInitialLanguage();
      $("langSelect").value = currentLang;
      setLanguage(currentLang);

      $("langSelect").addEventListener("change", (e) => {
        setLanguage(e.target.value);
      });

      updateTimePreview();
      $("birthTime").addEventListener("input", updateTimePreview);

      ["name","birthDate","birthTime"].forEach(id => {
        $(id).addEventListener("input", () => {
          saveInputs();
          updateDynamicTitle();
        });
      });

      // Auto-start if date exists
      if ($("birthDate").value) {
        start();
      }
    });
  </script>
</body>
</html>
