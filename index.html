<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="حاسبة العمر المباشر بالثواني والدقائق والساعات والأيام. أدخل تاريخ ووقت الميلاد وشاهد العمر يتحدث لحظيًا.">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0f172a">

  <link rel="canonical" href="https://tarekja.github.io/">
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon-512.png">

  <meta property="og:title" content="Live Age Calculator | حاسبة العمر المباشر">
  <meta property="og:description" content="احسب عمرك بشكل مباشر بالسنوات والأشهر والأيام والساعات والدقائق والثواني.">
  <meta property="og:url" content="https://tarekja.github.io/">
  <meta property="og:type" content="website">

  <!-- Google Analytics (مرة واحدة فقط) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ91MD319E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FZ91MD319E', { anonymize_ip: true });
  </script>

  <!-- Google AdSense -->
  <meta name="google-adsense-account" content="ca-pub-3878960602510145">
  <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3878960602510145"
          crossorigin="anonymous"></script>

  <title>Live Age Calculator | حاسبة العمر المباشر</title>

  <style>
    :root{
      color-scheme: dark;

      --bg:#0f172a;
      --panel:#020617;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --line:#1e293b;

      --btn:#38bdf8;
      --btnText:#0b1220;
      --btnGhostBorder:#1e293b;

      --ok:#34d399;
      --warn:#fbbf24;
      --err:#fb7185;
    }

    body{
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin:0;
      padding:0;
    }

    .page{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 18px 10px;
    }

    .container{
      width: min(650px, 92vw);
      margin: 0 auto;
    }

    .box{
      background: var(--panel);
      padding: 24px;
      border-radius:16px;
      box-shadow:0 0 40px rgba(0,0,0,0.7);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }

    .lang-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 13px;
    }

    select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      outline:none;
      cursor:pointer;
      appearance: none;
    }
    option{
      background: #0b1220;
      color: var(--text);
    }

    .share-wrap{
      display:flex;
      align-items:center;
      gap:8px;
    }

    .icon-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 8px 10px;
      cursor: pointer;
      user-select:none;
      white-space: nowrap;
    }
    .icon-btn:hover{ opacity: 0.92; }
    .icon{
      width:18px;
      height:18px;
      display:inline-block;
    }
    .icon svg{ width:18px; height:18px; fill: currentColor; }

    h1{
      text-align:center;
      margin:0 0 16px 0;
      font-size:22px;
      color: var(--accent);
    }

    .subnote{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin: -6px 0 16px 0;
      line-height: 1.5;
    }

    .field{ margin-bottom: 12px; }

    label{
      display:block;
      margin-bottom:5px;
      color: var(--muted);
      font-size:14px;
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    input{
      width:100%;
      padding: 10px;
      border-radius:10px;
      border: 1px solid transparent;
      outline: none;
      font-size:14px;
      box-sizing: border-box;
    }
    input:focus{
      border-color: rgba(56,189,248,0.5);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.12);
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }

    button{
      flex:1;
      background: var(--btn);
      border:none;
      color: var(--btnText);
      padding:10px 12px;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
      font-weight: bold;
    }
    button.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid var(--btnGhostBorder);
      font-weight: normal;
    }
    button:hover{ opacity:0.92; }

    .result{
      margin-top:22px;
      display:none;
    }

    .row{
      display:flex;
      justify-content:space-between;
      padding: 8px 0;
      border-bottom:1px solid var(--line);
      font-size:14px;
      gap: 16px;
      align-items: baseline;
    }
    .row:last-child{ border-bottom:none; }

    .label{ color: var(--muted); }
    .value{
      font-weight:bold;
      color: var(--text);
      text-align:left;
      direction:ltr;
      white-space: nowrap;
    }

    .section{
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
    }
    .section-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin:0 0 8px 0;
      font-weight: bold;
      color: var(--text);
    }
    .section-title small{
      font-weight: normal;
      color: var(--muted);
      font-size: 12px;
    }

    .kv{
      display:flex;
      justify-content:space-between;
      gap: 14px;
      padding: 7px 0;
      border-bottom: 1px dashed rgba(30,41,59,0.6);
      font-size: 13.5px;
    }
    .kv:last-child{ border-bottom:none; }
    .kv .k{ color: var(--muted); }
    .kv .v{
      font-weight: bold;
      color: var(--text);
      text-align: left;
      direction: ltr;
      white-space: nowrap;
    }
    .kv .v.rtl{
      text-align: right;
      direction: rtl;
      white-space: normal;
    }

    .toast{
      margin-top: 10px;
      display:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.6;
    }
    .toast.ok{ border-color: rgba(52,211,153,0.35); }
    .toast.err{ border-color: rgba(251,113,133,0.35); }

    .footer{
      margin-top: 16px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.7;
    }
    .footer a{ color: var(--accent); text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }

    details{
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(2,6,23,0.4);
    }
    summary{
      cursor: pointer;
      color: var(--text);
      font-weight: bold;
    }
    details p{
      margin: 10px 0 0 0;
      color: var(--muted);
      font-weight: normal;
    }

    .contact-meta{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--line);
      line-height: 1.9;
    }

    @media (max-width: 420px){
      .box{ padding: 18px; }
      h1{ font-size: 20px; }
      .container{ width: min(650px, 94vw); }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="box">

        <div class="topbar">
          <div class="lang-wrap">
            <span id="uiLangLabel">اللغة</span>
            <select id="langSelect" aria-label="Language selector">
              <option value="ar">العربية</option>
              <option value="tr">Türkçe</option>
              <option value="en">English</option>
            </select>
          </div>

          <div class="share-wrap">
            <button class="icon-btn" id="shareBtn" type="button" title="Share">
              <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <path d="M18 16a3 3 0 0 0-2.4 1.2L8.9 13.9A3.1 3.1 0 0 0 9 13a3.1 3.1 0 0 0-.1-.9l6.7-3.3A3 3 0 1 0 15 6a3 3 0 0 0 .1.9L8.4 10.2A3 3 0 1 0 9 13c0-.3 0-.6-.1-.9l6.7 3.3A3 3 0 1 0 18 16z"/>
                </svg>
              </span>
              <span id="shareLabel">شارك</span>
            </button>
          </div>
        </div>

        <h1 id="title">حاسبة العمر المباشر</h1>

        <div class="subnote" id="subnote">
          أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>
          (السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)
        </div>

        <div class="field">
          <label for="name" id="lblName">الاسم</label>
          <input type="text" id="name" placeholder="أدخل الاسم" maxlength="40">
          <div class="hint" id="hintName">اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.</div>
        </div>

        <div class="field">
          <label for="birthDate" id="lblBirthDate">تاريخ الميلاد</label>
          <input type="date" id="birthDate">
          <div class="hint" id="hintBirthDate">مطلوب. اختر التاريخ من التقويم.</div>
        </div>

        <div class="field">
          <label for="birthTime" id="lblBirthTime">ساعة الميلاد</label>
          <input type="time" id="birthTime" step="1">
          <div class="hint" id="hintBirthTime">
            اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>
            عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM صباحًا) أو <b>19:30</b> (PM مساءً).
          </div>
          <div class="hint" id="timePreview"></div>
        </div>

        <div class="actions">
          <button id="btnStart" onclick="start()">احسب العمر</button>
          <button id="btnReset" class="secondary" onclick="resetApp()">مسح</button>
        </div>

        <div class="result" id="result" aria-live="polite">

          <!-- Real-time age -->
          <div class="row"><div class="label" id="rYears">السنوات (تقريب)</div><div class="value" id="years"></div></div>
          <div class="row"><div class="label" id="rMonths">الأشهر (تقريب)</div><div class="value" id="months"></div></div>
          <div class="row"><div class="label" id="rWeeks">الأسابيع</div><div class="value" id="weeks"></div></div>
          <div class="row"><div class="label" id="rDays">الأيام</div><div class="value" id="days"></div></div>
          <div class="row"><div class="label" id="rHours">الساعات</div><div class="value" id="hours"></div></div>
          <div class="row"><div class="label" id="rMinutes">الدقائق</div><div class="value" id="minutes"></div></div>
          <div class="row"><div class="label" id="rSeconds">الثواني</div><div class="value" id="seconds"></div></div>

          <!-- Next birthday (Turkey time) -->
          <div class="section" id="nextBirthdaySection">
            <div class="section-title">
              <span id="nbTitle">عيد ميلادك القادم</span>
              <small id="nbTZ">توقيت تركيا (TR)</small>
            </div>
            <div class="kv">
              <div class="k" id="nbRemainingK">باقي لعيد ميلادك القادم:</div>
              <div class="v" id="nbRemainingV"></div>
            </div>
            <div class="kv">
              <div class="k" id="nbDayK">سيكون عيد ميلادك يوم:</div>
              <div class="v rtl" id="nbDayV"></div>
            </div>
            <div class="kv">
              <div class="k" id="nbHijriK">الموافق:</div>
              <div class="v rtl" id="nbHijriV"></div>
            </div>
          </div>

          <!-- Hijri age section -->
          <div class="section" id="hijriAgeSection">
            <div class="section-title">
              <span id="hTitle">العمر حسب التقويم الهجري</span>
              <small id="hCal">أم القرى</small>
            </div>
            <div class="kv">
              <div class="k" id="hBirthDateK">تاريخ الميلاد:</div>
              <div class="v rtl" id="hBirthDateV"></div>
            </div>
            <div class="kv">
              <div class="k" id="hBirthMonthK">شهر الميلاد:</div>
              <div class="v rtl" id="hBirthMonthV"></div>
            </div>
            <div class="kv">
              <div class="k" id="hAgeK">العمر:</div>
              <div class="v rtl" id="hAgeV"></div>
            </div>
            <div class="hint" id="hHint"></div>
          </div>

          <!-- More info -->
          <div class="section" id="moreInfoSection">
            <div class="section-title">
              <span id="miTitle">معلومات أكثر عن عمرك</span>
              <small id="miNote"></small>
            </div>
            <div class="kv">
              <div class="k" id="miBornDayK">وُلِدت يوم:</div>
              <div class="v rtl" id="miBornDayV"></div>
            </div>
            <div class="kv">
              <div class="k" id="miSeasonK">وُلِدت في فصل:</div>
              <div class="v rtl" id="miSeasonV"></div>
            </div>
            <div class="kv">
              <div class="k" id="miZodiacK">برجك:</div>
              <div class="v rtl" id="miZodiacV"></div>
            </div>
            <div class="kv">
              <div class="k" id="miSleepK">نومك الصحي:</div>
              <div class="v rtl" id="miSleepV"></div>
            </div>
          </div>

          <div class="toast" id="toast"></div>
        </div>

        <div class="footer">
          <div>
            <span id="usefulLinks">روابط مفيدة:</span>
            <a href="#about" onclick="openDetails('about')" id="lnkAbout">من نحن</a> ·
            <a href="/privacy.html" id="lnkPrivacy">سياسة الخصوصية</a> ·
            <a href="#contact" onclick="openDetails('contact')" id="lnkContact">تواصل</a>
          </div>

          <details id="about">
            <summary id="sumAbout">من نحن</summary>
            <p id="aboutText">
              هذه أداة بسيطة لحساب العمر بشكل مباشر (Real-time) عبر إدخال تاريخ ووقت الميلاد.
              الهدف هو تقديم تجربة سريعة وخفيفة تعمل على الجوال والكمبيوتر.
            </p>
          </details>

          <details id="contact">
            <summary id="sumContact">تواصل</summary>
            <p id="contactIntro">إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:</p>

            <div class="contact-meta">
              <div><b id="cNameLbl">الاسم:</b> <span id="cNameVal">Tarek Jawish</span></div>
              <div><b id="cRoleLbl">الصفة:</b> <span id="cRoleVal">MEAL Expert</span></div>
              <div><b id="cEmailLbl">البريد:</b> <a href="mailto:tarekjawish89@gmail.com">tarekjawish89@gmail.com</a></div>
              <div><b id="cLinkedLbl">LinkedIn:</b>
                <a href="https://www.linkedin.com/in/tarek-jawish-890998106/" target="_blank" rel="noopener noreferrer" id="cLinkedText">
                  الملف الشخصي
                </a>
              </div>
            </div>
          </details>
        </div>

      </div>
    </div>
  </div>

  <script>
    const TZ_TR = "Europe/Istanbul";
    let interval = null;

    const STORAGE_KEYS = {
      name: "lac_name",
      date: "lac_birthDate",
      time: "lac_birthTime",
      lang: "lac_lang"
    };

    function $(id){ return document.getElementById(id); }

    function openDetails(id){
      const el = $(id);
      if (el && el.tagName.toLowerCase() === "details"){
        el.open = true;
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function showToast(message, kind){
      const t = $("toast");
      if (!t) return;
      t.className = "toast " + (kind || "");
      t.textContent = message;
      t.style.display = "block";
      clearTimeout(showToast._tm);
      showToast._tm = setTimeout(()=>{ t.style.display="none"; }, 3500);
    }

    function saveInputs(){
      localStorage.setItem(STORAGE_KEYS.name, $("name").value || "");
      localStorage.setItem(STORAGE_KEYS.date, $("birthDate").value || "");
      localStorage.setItem(STORAGE_KEYS.time, $("birthTime").value || "");
    }

    function restoreInputs(){
      $("name").value = localStorage.getItem(STORAGE_KEYS.name) || "";
      $("birthDate").value = localStorage.getItem(STORAGE_KEYS.date) || "";
      $("birthTime").value = localStorage.getItem(STORAGE_KEYS.time) || "";
    }

    // ====== I18N ======
    const I18N = {
      ar: {
        langLabel: "اللغة",
        shareLabel: "شارك",
        titleBase: "حاسبة العمر المباشر",
        subnote: `أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>(السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)`,
        lblName: "الاسم",
        phName: "أدخل الاسم",
        hintName: "اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.",
        lblBirthDate: "تاريخ الميلاد",
        hintBirthDate: "مطلوب. اختر التاريخ من التقويم.",
        lblBirthTime: "ساعة الميلاد",
        hintBirthTime: `اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM صباحًا) أو <b>19:30</b> (PM مساءً).`,
        btnStart: "احسب العمر",
        btnReset: "مسح",
        rYears: "السنوات (تقريب)",
        rMonths: "الأشهر (تقريب)",
        rWeeks: "الأسابيع",
        rDays: "الأيام",
        rHours: "الساعات",
        rMinutes: "الدقائق",
        rSeconds: "الثواني",

        nbTitle: "عيد ميلادك القادم",
        nbTZ: "توقيت تركيا (TR)",
        nbRemainingK: "باقي لعيد ميلادك القادم:",
        nbDayK: "سيكون عيد ميلادك يوم:",
        nbHijriK: "الموافق:",

        hTitle: "العمر حسب التقويم الهجري",
        hCal: "أم القرى",
        hBirthDateK: "تاريخ الميلاد:",
        hBirthMonthK: "شهر الميلاد:",
        hAgeK: "العمر:",
        hHint: "الحساب يعتمد تقويم أم القرى (Umm al-Qura).",

        miTitle: "معلومات أكثر عن عمرك",
        miBornDayK: "وُلِدت يوم:",
        miSeasonK: "وُلِدت في فصل:",
        miZodiacK: "برجك:",
        miSleepK: "نومك الصحي:",
        miNote: "",

        usefulLinks: "روابط مفيدة:",
        lnkAbout: "من نحن",
        lnkPrivacy: "سياسة الخصوصية",
        lnkContact: "تواصل",
        sumAbout: "من نحن",
        aboutText: "هذه أداة بسيطة لحساب العمر بشكل مباشر (Real-time) عبر إدخال تاريخ ووقت الميلاد. الهدف هو تقديم تجربة سريعة وخفيفة تعمل على الجوال والكمبيوتر.",
        sumContact: "تواصل",
        contactIntro: "إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:",
        cNameLbl: "الاسم:",
        cRoleLbl: "الصفة:",
        cEmailLbl: "البريد:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "الملف الشخصي",

        alertNeedDate: "يرجى إدخال تاريخ الميلاد",
        alertInvalid: "الرجاء التأكد من صحة تاريخ/وقت الميلاد",
        alertFuture: "تاريخ/وقت الميلاد لا يمكن أن يكون في المستقبل",
        timeEmpty: `سيتم اعتبار الوقت <b>00:00:00</b> إذا تركته فارغًا.`,
        titleFor: (name) => `العمر المباشر لـ ${name}`,
        copied: "تم نسخ نص المشاركة.",
        shareTextGeneral: "جرب إدخال تاريخ ميلادك لترى عمرك المباشر بشكل لحظي.",
        shareTextWithResult: (summary) => `نتيجتي على حاسبة العمر المباشر:\n${summary}\n\nجربها هنا:`,
        season: {winter:"الشتاء", spring:"الربيع", summer:"الصيف", autumn:"الخريف"},
        zodiacNames: {
          aries:"الحمل", taurus:"الثور", gemini:"الجوزاء", cancer:"السرطان", leo:"الأسد", virgo:"العذراء",
          libra:"الميزان", scorpio:"العقرب", sagittarius:"القوس", capricorn:"الجدي", aquarius:"الدلو", pisces:"الحوت"
        },
        sleep: {
          toddler:"11–14 ساعة", preschool:"10–13 ساعة", school:"9–11 ساعة", teen:"8–10 ساعات",
          adult:"7–9 ساعات", older:"7–8 ساعات"
        },
        sleepLabel: (range) => `الموصى به تقريبًا: ${range}`,
        nextBirthdayRemaining: (mo, d, h, mi, s) => `${mo} شهر و ${d} يوم و ${h} ساعة و ${mi} دقيقة و ${s} ثانية`,
        hijriAgeFmt: (y,m,d) => `${y} سنة و ${m} شهر و ${d} يوم`,
        bornOn: (dow, dateStr) => `${dow} — ${dateStr}`,
      },

      en: {
        langLabel: "Language",
        shareLabel: "Share",
        titleBase: "Live Age Calculator",
        subnote: `Enter birth date and time, then watch your age update every second.<br>(Years/months are approximate — days/hours/minutes/seconds are exact)`,
        lblName: "Name",
        phName: "Enter name",
        hintName: "Optional. If empty, the general title will be shown without a name.",
        lblBirthDate: "Birth date",
        hintBirthDate: "Required. Choose the date from the calendar.",
        lblBirthTime: "Birth time",
        hintBirthTime: `Optional. If empty, time will be set to <b>00:00:00</b>.<br>Input is usually <b>24-hour</b> format: e.g., <b>07:30</b> (AM) or <b>19:30</b> (PM).`,
        btnStart: "Calculate",
        btnReset: "Clear",
        rYears: "Years (approx.)",
        rMonths: "Months (approx.)",
        rWeeks: "Weeks",
        rDays: "Days",
        rHours: "Hours",
        rMinutes: "Minutes",
        rSeconds: "Seconds",

        nbTitle: "Your next birthday",
        nbTZ: "Turkey time (TR)",
        nbRemainingK: "Time left until your birthday:",
        nbDayK: "Your birthday will be on:",
        nbHijriK: "Corresponding:",

        hTitle: "Age in Hijri calendar",
        hCal: "Umm al-Qura",
        hBirthDateK: "Hijri birth date:",
        hBirthMonthK: "Hijri birth month:",
        hAgeK: "Hijri age:",
        hHint: "Calculated using the Umm al-Qura calendar.",

        miTitle: "More about your age",
        miBornDayK: "Born on:",
        miSeasonK: "Season:",
        miZodiacK: "Zodiac sign:",
        miSleepK: "Healthy sleep:",
        miNote: "",

        usefulLinks: "Useful links:",
        lnkAbout: "About",
        lnkPrivacy: "Privacy Policy",
        lnkContact: "Contact",
        sumAbout: "About",
        aboutText: "A lightweight tool to calculate age in real time by entering birth date and time. Designed to work smoothly on mobile and desktop.",
        sumContact: "Contact",
        contactIntro: "For suggestions or feedback, you can reach me via:",
        cNameLbl: "Name:",
        cRoleLbl: "Role:",
        cEmailLbl: "Email:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profile",

        alertNeedDate: "Please enter your birth date",
        alertInvalid: "Please check the birth date/time values",
        alertFuture: "Birth date/time cannot be in the future",
        timeEmpty: `If left empty, time will be set to <b>00:00:00</b>.`,
        titleFor: (name) => `Live age for ${name}`,
        copied: "Share text copied.",
        shareTextGeneral: "Try entering your birth date to see your live age update in real time.",
        shareTextWithResult: (summary) => `My result on Live Age Calculator:\n${summary}\n\nTry it here:`,
        season: {winter:"Winter", spring:"Spring", summer:"Summer", autumn:"Autumn"},
        zodiacNames: {
          aries:"Aries", taurus:"Taurus", gemini:"Gemini", cancer:"Cancer", leo:"Leo", virgo:"Virgo",
          libra:"Libra", scorpio:"Scorpio", sagittarius:"Sagittarius", capricorn:"Capricorn", aquarius:"Aquarius", pisces:"Pisces"
        },
        sleep: {
          toddler:"11–14 hours", preschool:"10–13 hours", school:"9–11 hours", teen:"8–10 hours",
          adult:"7–9 hours", older:"7–8 hours"
        },
        sleepLabel: (range) => `Recommended: ${range}`,
        nextBirthdayRemaining: (mo, d, h, mi, s) => `${mo} mo, ${d} d, ${h} h, ${mi} min, ${s} s`,
        hijriAgeFmt: (y,m,d) => `${y} y, ${m} m, ${d} d`,
        bornOn: (dow, dateStr) => `${dow} — ${dateStr}`,
      },

      tr: {
        langLabel: "Dil",
        shareLabel: "Paylaş",
        titleBase: "Canlı Yaş Hesaplayıcı",
        subnote: `Doğum tarihi ve saatini girin, yaşınız her saniye güncellensin.<br>(Yıl/ay yaklaşık — gün/saat/dakika/saniye kesin)`,
        lblName: "İsim",
        phName: "İsim girin",
        hintName: "İsteğe bağlı. Boş bırakırsanız genel başlık gösterilir.",
        lblBirthDate: "Doğum tarihi",
        hintBirthDate: "Gerekli. Takvimden tarih seçin.",
        lblBirthTime: "Doğum saati",
        hintBirthTime: `İsteğe bağlı. Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.<br>Giriş genelde <b>24 saat</b> formatıdır: örn. <b>07:30</b> (AM) veya <b>19:30</b> (PM).`,
        btnStart: "Hesapla",
        btnReset: "Temizle",
        rYears: "Yıl (yaklaşık)",
        rMonths: "Ay (yaklaşık)",
        rWeeks: "Hafta",
        rDays: "Gün",
        rHours: "Saat",
        rMinutes: "Dakika",
        rSeconds: "Saniye",

        nbTitle: "Bir sonraki doğum günün",
        nbTZ: "Türkiye saati (TR)",
        nbRemainingK: "Doğum gününe kalan:",
        nbDayK: "Doğum günün şu gün olacak:",
        nbHijriK: "Karşılığı:",

        hTitle: "Hicri takvime göre yaş",
        hCal: "Umm al-Qura",
        hBirthDateK: "Hicri doğum tarihi:",
        hBirthMonthK: "Hicri doğum ayı:",
        hAgeK: "Hicri yaş:",
        hHint: "Umm al-Qura takvimine göre hesaplanır.",

        miTitle: "Yaşın hakkında daha fazla bilgi",
        miBornDayK: "Doğduğun gün:",
        miSeasonK: "Mevsim:",
        miZodiacK: "Burcun:",
        miSleepK: "Sağlıklı uyku:",
        miNote: "",

        usefulLinks: "Bağlantılar:",
        lnkAbout: "Hakkında",
        lnkPrivacy: "Gizlilik Politikası",
        lnkContact: "İletişim",
        sumAbout: "Hakkında",
        aboutText: "Doğum tarihi ve saatini girerek yaşınızı gerçek zamanlı hesaplayan hafif bir araç. Mobil ve masaüstünde sorunsuz çalışır.",
        sumContact: "İletişim",
        contactIntro: "Öneri veya geri bildirim için şu kanallardan ulaşabilirsiniz:",
        cNameLbl: "İsim:",
        cRoleLbl: "Unvan:",
        cEmailLbl: "E-posta:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profil",

        alertNeedDate: "Lütfen doğum tarihinizi girin",
        alertInvalid: "Lütfen doğum tarihi/saat değerlerini kontrol edin",
        alertFuture: "Doğum tarihi/saat gelecekte olamaz",
        timeEmpty: `Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.`,
        titleFor: (name) => `${name} için canlı yaş`,
        copied: "Paylaşım metni kopyalandı.",
        shareTextGeneral: "Doğum tarihinizi girerek yaşınızı saniye saniye canlı görün.",
        shareTextWithResult: (summary) => `Canlı Yaş Hesaplayıcı sonucum:\n${summary}\n\nBuradan deneyin:`,
        season: {winter:"Kış", spring:"İlkbahar", summer:"Yaz", autumn:"Sonbahar"},
        zodiacNames: {
          aries:"Koç", taurus:"Boğa", gemini:"İkizler", cancer:"Yengeç", leo:"Aslan", virgo:"Başak",
          libra:"Terazi", scorpio:"Akrep", sagittarius:"Yay", capricorn:"Oğlak", aquarius:"Kova", pisces:"Balık"
        },
        sleep: {
          toddler:"11–14 saat", preschool:"10–13 saat", school:"9–11 saat", teen:"8–10 saat",
          adult:"7–9 saat", older:"7–8 saat"
        },
        sleepLabel: (range) => `Önerilen: ${range}`,
        nextBirthdayRemaining: (mo, d, h, mi, s) => `${mo} ay, ${d} gün, ${h} saat, ${mi} dk, ${s} sn`,
        hijriAgeFmt: (y,m,d) => `${y} yıl, ${m} ay, ${d} gün`,
        bornOn: (dow, dateStr) => `${dow} — ${dateStr}`,
      }
    };

    const LANG_META = {
      ar: { dir: "rtl", lang: "ar" },
      en: { dir: "ltr", lang: "en" },
      tr: { dir: "ltr", lang: "tr" }
    };

    let currentLang = "ar";

    function pickInitialLanguage(){
      const saved = localStorage.getItem(STORAGE_KEYS.lang);
      if (saved && I18N[saved]) return saved;

      const urlLang = new URLSearchParams(window.location.search).get("lang");
      if (urlLang && I18N[urlLang]) return urlLang;

      const langs = (navigator.languages && navigator.languages.length)
        ? navigator.languages
        : [navigator.language || "en"];

      const lc = langs.map(x => String(x).toLowerCase());
      if (lc.some(x => x.startsWith("ar"))) return "ar";
      if (lc.some(x => x.startsWith("tr"))) return "tr";
      return "en";
    }

    function setLanguage(lang){
      if (!I18N[lang]) lang = "ar";
      currentLang = lang;
      localStorage.setItem(STORAGE_KEYS.lang, lang);

      document.documentElement.lang = LANG_META[lang].lang;
      document.documentElement.dir = LANG_META[lang].dir;

      const t = I18N[lang];

      $("uiLangLabel").textContent = t.langLabel;
      $("shareLabel").textContent = t.shareLabel;

      $("title").textContent = t.titleBase;
      $("subnote").innerHTML = t.subnote;

      $("lblName").textContent = t.lblName;
      $("name").placeholder = t.phName;
      $("hintName").textContent = t.hintName;

      $("lblBirthDate").textContent = t.lblBirthDate;
      $("hintBirthDate").textContent = t.hintBirthDate;

      $("lblBirthTime").textContent = t.lblBirthTime;
      $("hintBirthTime").innerHTML = t.hintBirthTime;

      $("btnStart").textContent = t.btnStart;
      $("btnReset").textContent = t.btnReset;

      $("rYears").textContent = t.rYears;
      $("rMonths").textContent = t.rMonths;
      $("rWeeks").textContent = t.rWeeks;
      $("rDays").textContent = t.rDays;
      $("rHours").textContent = t.rHours;
      $("rMinutes").textContent = t.rMinutes;
      $("rSeconds").textContent = t.rSeconds;

      $("nbTitle").textContent = t.nbTitle;
      $("nbTZ").textContent = t.nbTZ;
      $("nbRemainingK").textContent = t.nbRemainingK;
      $("nbDayK").textContent = t.nbDayK;
      $("nbHijriK").textContent = t.nbHijriK;

      $("hTitle").textContent = t.hTitle;
      $("hCal").textContent = t.hCal;
      $("hBirthDateK").textContent = t.hBirthDateK;
      $("hBirthMonthK").textContent = t.hBirthMonthK;
      $("hAgeK").textContent = t.hAgeK;
      $("hHint").textContent = t.hHint;

      $("miTitle").textContent = t.miTitle;
      $("miBornDayK").textContent = t.miBornDayK;
      $("miSeasonK").textContent = t.miSeasonK;
      $("miZodiacK").textContent = t.miZodiacK;
      $("miSleepK").textContent = t.miSleepK;
      $("miNote").textContent = t.miNote;

      $("usefulLinks").textContent = t.usefulLinks;
      $("lnkAbout").textContent = t.lnkAbout;
      $("lnkPrivacy").textContent = t.lnkPrivacy;
      $("lnkContact").textContent = t.lnkContact;

      $("sumAbout").textContent = t.sumAbout;
      $("aboutText").textContent = t.aboutText;

      $("sumContact").textContent = t.sumContact;
      $("contactIntro").textContent = t.contactIntro;

      $("cNameLbl").textContent = t.cNameLbl;
      $("cRoleLbl").textContent = t.cRoleLbl;
      $("cEmailLbl").textContent = t.cEmailLbl;
      $("cLinkedLbl").textContent = t.cLinkedLbl;
      $("cLinkedText").textContent = t.cLinkedText;

      updateTimePreview();
      updateDynamicTitle();

      // لو النتيجة ظاهرة، نحدّث أقسام النصوص حسب اللغة فوراً
      if ($("result").style.display === "block") {
        refreshAllDerivedOutputs();
      }
    }

    function updateDynamicTitle(){
      const name = ($("name").value || "").trim();
      const t = I18N[currentLang];
      const isResultVisible = $("result").style.display === "block";

      if (!isResultVisible){
        $("title").textContent = t.titleBase;
        return;
      }
      $("title").textContent = name ? t.titleFor(name) : t.titleBase;
    }

    function updateTimePreview(){
      const preview = $("timePreview");
      if (!preview) return;

      const t = I18N[currentLang];
      const timeVal = ($("birthTime").value || "").trim();

      if (!timeVal){
        preview.innerHTML = t.timeEmpty;
        return;
      }

      const parts = timeVal.split(":").map(Number);
      const hh24 = parts[0] ?? 0;
      const mm = parts[1] ?? 0;

      const isPM = hh24 >= 12;
      let hh12 = hh24 % 12;
      if (hh12 === 0) hh12 = 12;

      const ampm = isPM ? "PM" : "AM";
      const mm2 = String(mm).padStart(2, "0");
      preview.textContent = `${timeVal} = ${hh12}:${mm2} ${ampm}`;
    }

    // ====== Time zone helpers (Turkey) ======
    function getTZParts(date, timeZone){
      const dtf = new Intl.DateTimeFormat("en-US", {
        timeZone,
        hour12: false,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
      const parts = dtf.formatToParts(date);
      const out = {};
      for (const p of parts){
        if (p.type !== "literal") out[p.type] = p.value;
      }
      return {
        year: Number(out.year),
        month: Number(out.month),
        day: Number(out.day),
        hour: Number(out.hour),
        minute: Number(out.minute),
        second: Number(out.second)
      };
    }

    function tzOffsetMinutes(date, timeZone){
      const p = getTZParts(date, timeZone);
      const asUTC = Date.UTC(p.year, p.month - 1, p.day, p.hour, p.minute, p.second);
      return (asUTC - date.getTime()) / 60000; // tz - utc (minutes)
    }

    function makeInstantFromWallTimeInTZ(wall, timeZone){
      // wall: {year, month, day, hour, minute, second}
      const guessUTC = Date.UTC(wall.year, wall.month - 1, wall.day, wall.hour, wall.minute, wall.second);
      let instant = guessUTC;
      for (let i=0; i<3; i++){
        const off = tzOffsetMinutes(new Date(instant), timeZone);
        instant = guessUTC - off * 60000;
      }
      return new Date(instant);
    }

    // ====== Hijri (Umm al-Qura) ======
    function hijriPartsUmmAlQura(dateObj){
      // نستخدم en-US لضمان أرقام قابلة للقراءة
      const locale = "en-US-u-ca-islamic-umalqura";
      const dtf = new Intl.DateTimeFormat(locale, { day:"numeric", month:"numeric", year:"numeric" });
      const parts = dtf.formatToParts(dateObj);
      const out = {};
      for (const p of parts){
        if (p.type !== "literal") out[p.type] = p.value;
      }
      return {
        y: Number(out.year),
        m: Number(out.month),
        d: Number(out.day)
      };
    }

    function hijriLongUmmAlQura(dateObj){
      const localeMap = {
        ar: "ar-SA-u-ca-islamic-umalqura",
        en: "en-US-u-ca-islamic-umalqura",
        tr: "tr-TR-u-ca-islamic-umalqura"
      };
      const locale = localeMap[currentLang] || localeMap.en;
      try{
        const fmt = new Intl.DateTimeFormat(locale, { day:"numeric", month:"long", year:"numeric" });
        return fmt.format(dateObj);
      }catch(e){
        const fmt2 = new Intl.DateTimeFormat("en-US-u-ca-islamic", { day:"numeric", month:"long", year:"numeric" });
        return fmt2.format(dateObj);
      }
    }

    function hijriMonthNameUmmAlQura(dateObj){
      const localeMap = {
        ar: "ar-SA-u-ca-islamic-umalqura",
        en: "en-US-u-ca-islamic-umalqura",
        tr: "tr-TR-u-ca-islamic-umalqura"
      };
      const locale = localeMap[currentLang] || localeMap.en;
      try{
        const fmt = new Intl.DateTimeFormat(locale, { month:"long" });
        return fmt.format(dateObj);
      }catch(e){
        return "";
      }
    }

    // حساب عمر هجري (سنوات/أشهر/أيام) بطريقة دقيقة عبر تتبّع التغيّر اليومي في أم القرى
    function hijriAgeByDailyScan(birthDateTrMidnight, nowTrMidnight){
      // نشتغل على تواريخ منتصف الليل (تقليل اختلافات الوقت)
      let y = 0, m = 0, d = 0;

      const oneDay = 24 * 60 * 60 * 1000;
      let cur = new Date(birthDateTrMidnight.getTime());
      let prevH = hijriPartsUmmAlQura(cur);

      // نمشي يوم بيوم حتى نوصل لليوم الحالي (منتصف الليل)
      while (cur.getTime() < nowTrMidnight.getTime()){
        cur = new Date(cur.getTime() + oneDay);
        d++;

        const h = hijriPartsUmmAlQura(cur);

        // إذا صار يوم 1 => بداية شهر جديد => نرفع الأشهر ونصفّر الأيام
        if (h.d === 1 && (h.m !== prevH.m || h.y !== prevH.y)){
          m++;
          d = 0;
        }

        // إذا صار 1 محرم => بداية سنة جديدة
        if (h.m === 1 && h.d === 1 && (h.y !== prevH.y)){
          y++;
          m = 0;
          d = 0;
        }

        prevH = h;
      }

      return {y, m, d};
    }

    // ====== More info helpers ======
    function formatGregorianInTR(dateObj, withTime){
      const locale = (currentLang === "ar") ? "ar" : (currentLang === "tr" ? "tr-TR" : "en-US");
      const opts = withTime
        ? { timeZone: TZ_TR, weekday:"long", year:"numeric", month:"long", day:"numeric", hour:"2-digit", minute:"2-digit" }
        : { timeZone: TZ_TR, weekday:"long", year:"numeric", month:"long", day:"numeric" };
      try{
        return new Intl.DateTimeFormat(locale, opts).format(dateObj);
      }catch(e){
        return dateObj.toString();
      }
    }

    function weekdayInTR(dateObj){
      const locale = (currentLang === "ar") ? "ar" : (currentLang === "tr" ? "tr-TR" : "en-US");
      return new Intl.DateTimeFormat(locale, { timeZone: TZ_TR, weekday:"long" }).format(dateObj);
    }

    function seasonByMonth(month){
      // موسم أرصادي (أنسب للمستخدم): ديسمبر-فبراير شتاء، مارس-مايو ربيع...
      const t = I18N[currentLang].season;
      if ([12,1,2].includes(month)) return t.winter;
      if ([3,4,5].includes(month)) return t.spring;
      if ([6,7,8].includes(month)) return t.summer;
      return t.autumn;
    }

    function zodiacSign(month, day){
      // Western zodiac
      // Aquarius (Jan 20–Feb 18), Pisces (Feb 19–Mar 20), Aries (Mar 21–Apr 19), Taurus (Apr 20–May 20),
      // Gemini (May 21–Jun 20), Cancer (Jun 21–Jul 22), Leo (Jul 23–Aug 22), Virgo (Aug 23–Sep 22),
      // Libra (Sep 23–Oct 22), Scorpio (Oct 23–Nov 21), Sagittarius (Nov 22–Dec 21), Capricorn (Dec 22–Jan 19)
      const z = I18N[currentLang].zodiacNames;
      const md = month * 100 + day;
      if (md >= 120 && md <= 218) return z.aquarius;
      if (md >= 219 && md <= 320) return z.pisces;
      if (md >= 321 && md <= 419) return z.aries;
      if (md >= 420 && md <= 520) return z.taurus;
      if (md >= 521 && md <= 620) return z.gemini;
      if (md >= 621 && md <= 722) return z.cancer;
      if (md >= 723 && md <= 822) return z.leo;
      if (md >= 823 && md <= 922) return z.virgo;
      if (md >= 923 && md <= 1022) return z.libra;
      if (md >= 1023 && md <= 1121) return z.scorpio;
      if (md >= 1122 && md <= 1221) return z.sagittarius;
      return z.capricorn;
    }

    function sleepRecommendationByAgeYears(years){
      const s = I18N[currentLang].sleep;
      if (years < 3) return s.toddler;
      if (years < 6) return s.preschool;
      if (years < 14) return s.school;
      if (years < 18) return s.teen;
      if (years < 65) return s.adult;
      return s.older;
    }

    // ====== App logic ======
    function buildLocalDate(dateStr, timeStr){
      const parts = (dateStr || "").split("-").map(Number);
      if (parts.length !== 3 || parts.some(Number.isNaN)) return null;

      const t = (timeStr && timeStr.trim()) ? timeStr.trim() : "00:00:00";
      const tParts = t.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mm = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      const y = parts[0], m = parts[1], d = parts[2];
      const dt = new Date(y, m - 1, d, hh, mm, ss);
      if (Number.isNaN(dt.getTime())) return null;
      return dt;
    }

    function resetApp(){
      if (interval) {
        clearInterval(interval);
        interval = null;
      }

      $("result").style.display = "none";
      ["years","months","weeks","days","hours","minutes","seconds"].forEach(id => $(id).textContent = "");

      $("nbRemainingV").textContent = "";
      $("nbDayV").textContent = "";
      $("nbHijriV").textContent = "";

      $("hBirthDateV").textContent = "";
      $("hBirthMonthV").textContent = "";
      $("hAgeV").textContent = "";

      $("miBornDayV").textContent = "";
      $("miSeasonV").textContent = "";
      $("miZodiacV").textContent = "";
      $("miSleepV").textContent = "";

      $("name").value = "";
      $("birthDate").value = "";
      $("birthTime").value = "";

      localStorage.removeItem(STORAGE_KEYS.name);
      localStorage.removeItem(STORAGE_KEYS.date);
      localStorage.removeItem(STORAGE_KEYS.time);

      updateTimePreview();
      setLanguage(currentLang);
    }

    // ====== Next birthday logic (Turkey time) ======
    function computeNextBirthdayInstantTR(birthWallMonth, birthWallDay, birthWallHour, birthWallMinute, birthWallSecond){
      const now = new Date();
      const nowTR = getTZParts(now, TZ_TR);

      let year = nowTR.year;

      // نقرر السنة القادمة بناءً على المقارنة في توقيت تركيا
      const nowKey = nowTR.month * 1000000 + nowTR.day * 10000 + nowTR.hour * 100 + nowTR.minute;
      const bKey   = birthWallMonth * 1000000 + birthWallDay * 10000 + birthWallHour * 100 + birthWallMinute;

      if (bKey <= nowKey) year += 1;

      const wall = {
        year,
        month: birthWallMonth,
        day: birthWallDay,
        hour: birthWallHour,
        minute: birthWallMinute,
        second: birthWallSecond
      };

      return makeInstantFromWallTimeInTZ(wall, TZ_TR);
    }

    function remainingToNextBirthdayTR(nextBirthdayInstant){
      const now = new Date();
      const diffMs = Math.max(0, nextBirthdayInstant.getTime() - now.getTime());

      const secTotal = Math.floor(diffMs / 1000);
      const s = secTotal % 60;

      const minTotal = Math.floor(secTotal / 60);
      const mi = minTotal % 60;

      const hrTotal = Math.floor(minTotal / 60);
      const h = hrTotal % 24;

      const dayTotal = Math.floor(hrTotal / 24);

      // "شهر" هنا تحويل عملي: متوسط طول الشهر 30.44 يوم
      const monthsApprox = Math.floor(dayTotal / 30.44);
      const daysRem = Math.max(0, dayTotal - Math.floor(monthsApprox * 30.44));

      return { monthsApprox, daysRem, h, mi, s };
    }

    // ====== Share (with result text) ======
    function siteUrl(){
      return window.location.origin + window.location.pathname;
    }

    function buildShareSummary(){
      const t = I18N[currentLang];

      if ($("result").style.display !== "block"){
        return { title: t.titleBase, text: t.shareTextGeneral, url: siteUrl() };
      }

      const name = ($("name").value || "").trim();
      const title = name ? t.titleFor(name) : t.titleBase;

      const summaryLines = [];
      summaryLines.push(`${t.rDays}: ${$("days").textContent}`);
      summaryLines.push(`${t.rHours}: ${$("hours").textContent}`);
      summaryLines.push(`${t.rMinutes}: ${$("minutes").textContent}`);
      summaryLines.push(`${t.rSeconds}: ${$("seconds").textContent}`);
      summaryLines.push(`${t.nbRemainingK} ${$("nbRemainingV").textContent}`);
      summaryLines.push(`${t.nbDayK} ${$("nbDayV").textContent}`);
      summaryLines.push(`${t.nbHijriK} ${$("nbHijriV").textContent}`);

      const text = t.shareTextWithResult(summaryLines.join("\n"));
      return { title, text, url: siteUrl() };
    }

    async function shareNow(){
      const t = I18N[currentLang];
      const payload = buildShareSummary();

      try{
        if (navigator.share){
          await navigator.share(payload);
          return;
        }
      }catch(e){
        // إذا المستخدم لغى المشاركة، لا نعرض خطأ
        return;
      }

      // fallback: copy share text + url
      const copyText = `${payload.text}\n${payload.url}`;
      try{
        await navigator.clipboard.writeText(copyText);
        showToast(t.copied, "ok");
      }catch(e){
        window.prompt("Copy:", copyText);
      }
    }

    // ====== Derived outputs refresh ======
    let _lastBirthDateObj = null; // نحفظ آخر تاريخ ميلاد محسوب
    let _lastBirthWall = null;    // {month, day, hour, minute, second}
    let _nextBirthdayInstantTR = null;

    function refreshAllDerivedOutputs(){
      if (!_lastBirthDateObj || !_lastBirthWall) return;

      // 1) Next birthday in TR
      _nextBirthdayInstantTR = computeNextBirthdayInstantTR(
        _lastBirthWall.month, _lastBirthWall.day,
        _lastBirthWall.hour, _lastBirthWall.minute, _lastBirthWall.second
      );

      // "سيكون عيد ميلادك يوم ..." (ميلادي/تركي)
      $("nbDayV").textContent = formatGregorianInTR(_nextBirthdayInstantTR, true);

      // "الموافق" (هجري أم القرى) لنفس لحظة العيد
      $("nbHijriV").textContent = hijriLongUmmAlQura(_nextBirthdayInstantTR);

      // 2) Hijri section
      $("hBirthDateV").textContent = hijriLongUmmAlQura(_lastBirthDateObj);
      $("hBirthMonthV").textContent = hijriMonthNameUmmAlQura(_lastBirthDateObj);

      // حساب العمر الهجري بدقة بالمسح اليومي (بمنتصف ليل تركيا)
      const now = new Date();
      const nowTR = getTZParts(now, TZ_TR);
      const nowTRMidnight = makeInstantFromWallTimeInTZ({year: nowTR.year, month: nowTR.month, day: nowTR.day, hour:0, minute:0, second:0}, TZ_TR);

      const bTR = getTZParts(_lastBirthDateObj, TZ_TR);
      const birthTRMidnight = makeInstantFromWallTimeInTZ({year: bTR.year, month: bTR.month, day: bTR.day, hour:0, minute:0, second:0}, TZ_TR);

      const hijriAge = hijriAgeByDailyScan(birthTRMidnight, nowTRMidnight);
      $("hAgeV").textContent = I18N[currentLang].hijriAgeFmt(hijriAge.y, hijriAge.m, hijriAge.d);

      // 3) More info
      const birthTRParts = getTZParts(_lastBirthDateObj, TZ_TR);
      const birthMonth = birthTRParts.month;
      const birthDay = birthTRParts.day;

      const dow = weekdayInTR(_lastBirthDateObj);
      const birthDateStrTR = formatGregorianInTR(_lastBirthDateObj, true);
      $("miBornDayV").textContent = I18N[currentLang].bornOn(dow, birthDateStrTR);

      $("miSeasonV").textContent = seasonByMonth(birthMonth);
      $("miZodiacV").textContent = zodiacSign(birthMonth, birthDay);

      // النوم الصحي حسب العمر التقريبي (سنوات)
      const yearsApprox = Number($("years").textContent) || 0;
      const sleepRange = sleepRecommendationByAgeYears(yearsApprox);
      $("miSleepV").textContent = I18N[currentLang].sleepLabel(sleepRange);
    }

    function start(){
      const t = I18N[currentLang];

      const name = ($("name").value || "").trim();
      const date = $("birthDate").value;
      const time = $("birthTime").value || "00:00:00";

      if (!date){
        alert(t.alertNeedDate);
        return;
      }

      const birthDate = buildLocalDate(date, time);
      if (!birthDate){
        alert(t.alertInvalid);
        return;
      }

      if (birthDate.getTime() > Date.now()){
        alert(t.alertFuture);
        return;
      }

      // حفظ
      saveInputs();

      // تفعيل النتيجة
      $("result").style.display = "block";
      updateDynamicTitle();

      // نحفظ لاستخدامها في الأقسام الأخرى
      _lastBirthDateObj = birthDate;

      // نقرأ "قيم الميلاد" كـ wall-time في توقيت تركيا (حتى لو المستخدم زائر من بلد آخر)
      // نأخذ الشهر/اليوم من تاريخ الإدخال نفسه (الميلادي)
      const partsDate = date.split("-").map(Number);
      const birthWallMonth = partsDate[1];
      const birthWallDay = partsDate[2];

      const timeParts = (time || "00:00:00").split(":").map(Number);
      const birthWallHour = timeParts[0] ?? 0;
      const birthWallMinute = timeParts[1] ?? 0;
      const birthWallSecond = timeParts[2] ?? 0;

      _lastBirthWall = { month: birthWallMonth, day: birthWallDay, hour: birthWallHour, minute: birthWallMinute, second: birthWallSecond };

      if (interval) clearInterval(interval);

      function update(){
        const now = Date.now();
        let diffMs = now - birthDate.getTime();
        if (diffMs < 0) diffMs = 0;

        const seconds = Math.floor(diffMs / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours   = Math.floor(minutes / 60);
        const days    = Math.floor(hours / 24);
        const weeks   = Math.floor(days / 7);

        const yearsApprox  = diffMs / (1000 * 60 * 60 * 24 * 365.2425);
        const monthsApprox = yearsApprox * 12;

        $("years").textContent    = yearsApprox.toFixed(6);
        $("months").textContent   = monthsApprox.toFixed(2);
        $("weeks").textContent    = weeks.toLocaleString();
        $("days").textContent     = days.toLocaleString();
        $("hours").textContent    = hours.toLocaleString();
        $("minutes").textContent  = minutes.toLocaleString();
        $("seconds").textContent  = seconds.toLocaleString();

        // تحديث عيد الميلاد القادم (TR) كل ثانية
        if (!_nextBirthdayInstantTR){
          refreshAllDerivedOutputs();
        }
        const rem = remainingToNextBirthdayTR(_nextBirthdayInstantTR);
        $("nbRemainingV").textContent = t.nextBirthdayRemaining(rem.monthsApprox, rem.daysRem, rem.h, rem.mi, rem.s);

        // تحديث توصية النوم مع مرور السنوات (بشكل ناعم)
        const sleepRange = sleepRecommendationByAgeYears(yearsApprox);
        $("miSleepV").textContent = t.sleepLabel(sleepRange);
      }

      // مرة واحدة لتعبئة الأقسام الثابتة
      refreshAllDerivedOutputs();

      // تحديث فوري + مؤقت كل ثانية
      update();
      interval = setInterval(update, 1000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      // منع اختيار تاريخ مستقبلي (حسب تاريخ الجهاز)
      const today = new Date().toISOString().split("T")[0];
      $("birthDate").setAttribute("max", today);

      restoreInputs();

      currentLang = pickInitialLanguage();
      $("langSelect").value = currentLang;
      setLanguage(currentLang);

      $("langSelect").addEventListener("change", (e) => setLanguage(e.target.value));

      $("shareBtn").addEventListener("click", shareNow);

      updateTimePreview();
      $("birthTime").addEventListener("input", updateTimePreview);

      ["name","birthDate","birthTime"].forEach(id => {
        $(id).addEventListener("input", () => {
          saveInputs();
          updateDynamicTitle();
        });
      });

      if ($("birthDate").value) start();
    });
  </script>
</body>
</html>
