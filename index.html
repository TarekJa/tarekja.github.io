<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="حاسبة العمر المباشر بالثواني والدقائق والساعات والأيام. أدخل تاريخ ووقت الميلاد وشاهد العمر يتحدث لحظيًا.">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0f172a">

  <link rel="canonical" href="https://tarekja.github.io/">
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon-512.png">

  <meta property="og:title" content="Live Age Calculator | حاسبة العمر المباشر">
  <meta property="og:description" content="احسب عمرك بشكل مباشر بالسنوات والأشهر والأيام والساعات والدقائق والثواني.">
  <meta property="og:url" content="https://tarekja.github.io/">
  <meta property="og:type" content="website">

  <!-- Google Analytics (مرة واحدة فقط) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ91MD319E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FZ91MD319E', { anonymize_ip: true });
  </script>

  <!-- Google AdSense -->
  <meta name="google-adsense-account" content="ca-pub-3878960602510145">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3878960602510145" crossorigin="anonymous"></script>

  <title>Live Age Calculator | حاسبة العمر المباشر</title>

  <style>
    :root{
      --bg:#0f172a;
      --panel:#020617;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --line:#1e293b;
      color-scheme: dark;
    }

    body{
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin:0;
      padding:0;
    }

    .page{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 18px 10px;
    }

    .container{
      width: min(720px, 94vw);
      margin: 0 auto;
    }

    .box{
      background: var(--panel);
      padding: 22px;
      border-radius:16px;
      box-shadow:0 0 40px rgba(0,0,0,0.7);
      border: 1px solid rgba(148,163,184,0.10);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }

    .lang-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 13px;
    }

    select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      outline:none;
      cursor:pointer;
    }
    option{
      background:#0b1220;
      color: var(--text);
    }

    .share-btn{
      display:flex;
      align-items:center;
      gap:8px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      user-select:none;
      white-space: nowrap;
    }
    .share-btn:hover{ background: rgba(255,255,255,0.06); }
    .share-btn svg{ width:18px; height:18px; opacity:0.95; }

    h1{
      text-align:center;
      margin:10px 0 10px 0;
      font-size:22px;
      color: var(--accent);
    }

    .subnote{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin: 0 0 16px 0;
      line-height: 1.6;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 680px){
      .grid{ grid-template-columns: 1fr; }
    }

    .field{ margin-bottom: 12px; }

    label{
      display:block;
      margin-bottom:6px;
      color: var(--muted);
      font-size:14px;
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    input{
      width:100%;
      padding: 10px;
      border-radius:10px;
      border: 1px solid transparent;
      outline: none;
      font-size:14px;
      box-sizing: border-box;
      background: rgba(255,255,255,0.95);
      color:#0b1220;
    }

    input:focus{
      border-color: rgba(56,189,248,0.55);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.12);
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }

    button{
      flex:1;
      background: var(--accent);
      border:none;
      color:#0b1220;
      padding:10px 12px;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
      font-weight: bold;
    }
    button.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid var(--line);
      font-weight: normal;
    }
    button:hover{ opacity:0.92; }

    .result{
      margin-top:18px;
      display:none;
    }

    .section{
      margin-top: 14px;
      border: 1px solid rgba(148,163,184,0.14);
      border-radius: 14px;
      overflow: hidden;
    }
    .section-h{
      padding: 12px 14px;
      background: rgba(255,255,255,0.03);
      border-bottom: 1px solid rgba(148,163,184,0.10);
      font-weight: bold;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
    }
    .section-b{
      padding: 12px 14px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      padding: 10px 0;
      border-bottom:1px dashed rgba(148,163,184,0.20);
      font-size:14px;
      gap: 16px;
    }
    .row:last-child{ border-bottom:none; }

    .k{ color: var(--muted); }
    .v{
      font-weight:bold;
      color: var(--text);
      text-align:left;
      direction:ltr;
      white-space: nowrap;
    }

    /* قيم نصية عربية حتى لا تنقلب الأرقام */
    .v.rtl{
      direction: rtl;
      text-align: right;
      unicode-bidi: plaintext;
      white-space: normal;
    }

    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.8;
      text-align:center;
    }
    .footer a{ color: var(--accent); text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }

    details{
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(2,6,23,0.35);
      text-align: start;
    }
    summary{
      cursor: pointer;
      color: var(--text);
      font-weight: bold;
    }
    details p{
      margin: 10px 0 0 0;
      color: var(--muted);
      font-weight: normal;
      line-height: 1.7;
    }

    .contact-meta{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--line);
      line-height: 1.95;
    }

    /* نافذة مشاركة احتياطية */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 9999;
    }
    .modal-card{
      width: min(520px, 96vw);
      background: #060b18;
      border: 1px solid rgba(148,163,184,0.20);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 0 40px rgba(0,0,0,0.75);
    }
    .modal-h{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .modal-h button{
      flex:0 0 auto;
      padding: 8px 10px;
      border-radius: 10px;
      background: transparent;
      border: 1px solid rgba(148,163,184,0.25);
      color: var(--text);
      cursor:pointer;
    }
    .share-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .share-grid a, .share-grid button{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.18);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      text-decoration:none;
      cursor:pointer;
      font-weight: bold;
    }
    .share-grid a:hover, .share-grid button:hover{
      background: rgba(255,255,255,0.06);
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      opacity: 0.9;
      overflow-wrap:anywhere;
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="box">

        <div class="topbar">
          <div class="lang-wrap">
            <span id="uiLangLabel">اللغة</span>
            <select id="langSelect" aria-label="Language selector">
              <option value="ar">العربية</option>
              <option value="tr">Türkçe</option>
              <option value="en">English</option>
            </select>
          </div>

          <button class="share-btn" id="shareBtn" type="button" aria-label="Share">
            <!-- Share icon (3 nodes) -->
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M16 8a3 3 0 1 0-2.8-4H13a3 3 0 0 0 3 4Zm-8 7a3 3 0 1 0 2.8 4H11a3 3 0 0 0-3-4Zm8 1a3 3 0 1 0 2.8 4H19a3 3 0 0 0-3-4Z" fill="currentColor" opacity="0.95"/>
              <path d="M8.9 13.5 14.9 9.7M9.1 14.3l5.8 3.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" opacity="0.9"/>
            </svg>
            <span id="shareBtnText">مشاركة</span>
          </button>
        </div>

        <h1 id="title">حاسبة العمر المباشر</h1>
        <div class="subnote" id="subnote">
          أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>
          (السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)
        </div>

        <div class="grid">
          <div>
            <div class="field">
              <label for="name" id="lblName">الاسم</label>
              <input type="text" id="name" placeholder="أدخل الاسم" maxlength="40">
              <div class="hint" id="hintName">اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.</div>
            </div>

            <div class="field">
              <label for="birthDate" id="lblBirthDate">تاريخ الميلاد</label>
              <input type="date" id="birthDate">
              <div class="hint" id="hintBirthDate">مطلوب. اختر التاريخ من التقويم.</div>
            </div>

            <div class="field">
              <label for="birthTime" id="lblBirthTime">ساعة الميلاد</label>
              <input type="time" id="birthTime" step="1">
              <div class="hint" id="hintBirthTime">
                اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>
                عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM) أو <b>19:30</b> (PM).
              </div>
              <div class="hint" id="timePreview"></div>
            </div>

            <div class="actions">
              <button id="btnStart" type="button">احسب العمر</button>
              <button id="btnReset" class="secondary" type="button">مسح</button>
            </div>
          </div>

          <div>
            <div class="result" id="result" aria-live="polite">

              <!-- العمر المباشر -->
              <div class="section">
                <div class="section-h">
                  <span id="secLiveTitle">العمر الآن</span>
                  <span class="k" id="secLiveTZ">(TR)</span>
                </div>
                <div class="section-b">
                  <div class="row"><div class="k" id="rYears">السنوات (تقريب)</div><div class="v" id="years"></div></div>
                  <div class="row"><div class="k" id="rMonths">الأشهر (تقريب)</div><div class="v" id="months"></div></div>
                  <div class="row"><div class="k" id="rWeeks">الأسابيع</div><div class="v" id="weeks"></div></div>
                  <div class="row"><div class="k" id="rDays">الأيام</div><div class="v" id="days"></div></div>
                  <div class="row"><div class="k" id="rHours">الساعات</div><div class="v" id="hours"></div></div>
                  <div class="row"><div class="k" id="rMinutes">الدقائق</div><div class="v" id="minutes"></div></div>
                  <div class="row"><div class="k" id="rSeconds">الثواني</div><div class="v" id="seconds"></div></div>
                </div>
              </div>

              <!-- عيد الميلاد القادم -->
              <div class="section" id="nextBirthdaySection">
                <div class="section-h">
                  <span id="nbTitle">عيد ميلادك القادم</span>
                  <span class="k" id="nbTZ">(TR)</span>
                </div>
                <div class="section-b">
                  <div class="row"><div class="k" id="nbRemainingK">باقي لعيد ميلادك القادم:</div><div class="v rtl" id="nbRemainingV"></div></div>
                  <div class="row"><div class="k" id="nbWillBeK">سيكون عيد ميلادك يوم:</div><div class="v rtl" id="nbWillBeV"></div></div>
                  <div class="row"><div class="k" id="nbHijriK">الموافق:</div><div class="v rtl" id="nbHijriV"></div></div>
                </div>
              </div>

              <!-- التقويم الهجري (أم القرى) -->
              <div class="section" id="hijriSection">
                <div class="section-h">
                  <span id="hTitle">العمر حسب التقويم الهجري</span>
                  <span class="k" id="hNote"></span>
                </div>
                <div class="section-b">
                  <div class="row"><div class="k" id="hBirthDateK">تاريخ الميلاد:</div><div class="v rtl" id="hBirthDateV"></div></div>
                  <div class="row"><div class="k" id="hBirthMonthK">شهر الميلاد:</div><div class="v rtl" id="hBirthMonthV"></div></div>
                  <div class="row"><div class="k" id="hAgeK">العمر:</div><div class="v rtl" id="hAgeV"></div></div>
                  <div class="hint" id="hHint"></div>
                </div>
              </div>

              <!-- معلومات أكثر -->
              <div class="section" id="moreInfoSection">
                <div class="section-h">
                  <span id="miTitle">معلومات أكثر عن عمرك</span>
                </div>
                <div class="section-b">
                  <div class="row"><div class="k" id="miBornDayK">ولدت يوم:</div><div class="v rtl" id="miBornDayV"></div></div>
                  <div class="row"><div class="k" id="miSeasonK">ولدت في فصل:</div><div class="v rtl" id="miSeasonV"></div></div>
                  <div class="row"><div class="k" id="miZodiacK">برجك:</div><div class="v rtl" id="miZodiacV"></div></div>
                  <div class="row"><div class="k" id="miSleepK">نومك الصحي:</div><div class="v rtl" id="miSleepV"></div></div>
                </div>
              </div>

            </div>

            <div class="footer">
              <div>
                <span id="usefulLinks">روابط مفيدة:</span>
                <a href="#about" id="lnkAbout">من نحن</a> ·
                <a href="/privacy.html" id="lnkPrivacy">سياسة الخصوصية</a> ·
                <a href="#contact" id="lnkContact">تواصل</a>
              </div>

              <details id="about">
                <summary id="sumAbout">من نحن</summary>
                <p id="aboutText">
                  هذه أداة بسيطة لحساب العمر بشكل مباشر عبر إدخال تاريخ ووقت الميلاد، وتعمل بسلاسة على الجوال والكمبيوتر.
                </p>
              </details>

              <details id="contact">
                <summary id="sumContact">تواصل</summary>
                <p id="contactIntro">إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر:</p>

                <div class="contact-meta">
                  <div><b id="cNameLbl">الاسم:</b> <span id="cNameVal">Tarek Jawish</span></div>
                  <div><b id="cRoleLbl">الصفة:</b> <span id="cRoleVal">MEAL Expert</span></div>
                  <div><b id="cEmailLbl">البريد:</b> <a href="mailto:tarekjawish89@gmail.com">tarekjawish89@gmail.com</a></div>
                  <div><b id="cLinkedLbl">LinkedIn:</b>
                    <a href="https://www.linkedin.com/in/tarek-jawish-890998106/" target="_blank" rel="noopener noreferrer" id="cLinkedText">الملف الشخصي</a>
                  </div>
                </div>
              </details>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal fallback -->
  <div class="modal" id="shareModal" role="dialog" aria-modal="true" aria-labelledby="shareModalTitle">
    <div class="modal-card">
      <div class="modal-h">
        <div id="shareModalTitle">مشاركة</div>
        <button type="button" id="shareCloseBtn">×</button>
      </div>
      <div class="hint" id="shareHint"></div>
      <div class="mono" id="sharePreview"></div>

      <div class="share-grid" style="margin-top:12px;">
        <a id="shareWhatsApp" href="#" target="_blank" rel="noopener noreferrer">WhatsApp</a>
        <a id="shareFacebook" href="#" target="_blank" rel="noopener noreferrer">Facebook</a>
        <a id="shareX" href="#" target="_blank" rel="noopener noreferrer">X</a>
        <button type="button" id="copyBtn">Copy</button>
      </div>
    </div>
  </div>

  <script>
    // ====== Constants / Storage ======
    let interval = null;

    const STORAGE_KEYS = {
      name: "lac_name",
      date: "lac_birthDate",
      time: "lac_birthTime",
      lang: "lac_lang"
    };

    function $(id){ return document.getElementById(id); }

    // نستخدم "UTC format" لعرض أوقات TR بشكل ثابت داخل الحساب (wall-time) لتفادي مشاكل RTL/DST.
    const TZ_LABEL = "TR";
    const TZ_WALL = "UTC"; // عرض فقط (wall-time)
    const MS_SEC = 1000;
    const MS_MIN = 60 * MS_SEC;
    const MS_HR  = 60 * MS_MIN;
    const MS_DAY = 24 * MS_HR;

    // ====== I18N ======
    const I18N = {
      ar: {
        langLabel: "اللغة",
        shareBtn: "مشاركة",
        titleBase: "حاسبة العمر المباشر",
        subnote: `أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>(السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)`,
        lblName: "الاسم",
        phName: "أدخل الاسم",
        hintName: "اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.",
        lblBirthDate: "تاريخ الميلاد",
        hintBirthDate: "مطلوب. اختر التاريخ من التقويم.",
        lblBirthTime: "ساعة الميلاد",
        hintBirthTime: `اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM) أو <b>19:30</b> (PM).`,
        btnStart: "احسب العمر",
        btnReset: "مسح",
        secLiveTitle: "العمر الآن",
        rYears: "السنوات (تقريب)",
        rMonths: "الأشهر (تقريب)",
        rWeeks: "الأسابيع",
        rDays: "الأيام",
        rHours: "الساعات",
        rMinutes: "الدقائق",
        rSeconds: "الثواني",

        nbTitle: "عيد ميلادك القادم",
        nbRemainingK: "باقي لعيد ميلادك القادم:",
        nbWillBeK: "سيكون عيد ميلادك يوم:",
        nbHijriK: "الموافق:",

        hTitle: "العمر حسب التقويم الهجري",
        hBirthDateK: "تاريخ الميلاد:",
        hBirthMonthK: "شهر الميلاد:",
        hAgeK: "العمر:",
        hHint: "الحساب يعتمد تقويم أم القرى (Umm al-Qura).",

        miTitle: "معلومات أكثر عن عمرك",
        miBornDayK: "ولدت يوم:",
        miSeasonK: "ولدت في فصل:",
        miZodiacK: "برجك:",
        miSleepK: "نومك الصحي:",

        usefulLinks: "روابط مفيدة:",
        lnkAbout: "من نحن",
        lnkPrivacy: "سياسة الخصوصية",
        lnkContact: "تواصل",
        sumAbout: "من نحن",
        aboutText: "هذه أداة بسيطة لحساب العمر بشكل مباشر عبر إدخال تاريخ ووقت الميلاد، وتعمل بسلاسة على الجوال والكمبيوتر.",
        sumContact: "تواصل",
        contactIntro: "إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر:",
        cNameLbl: "الاسم:",
        cRoleLbl: "الصفة:",
        cEmailLbl: "البريد:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "الملف الشخصي",

        alertNeedDate: "يرجى إدخال تاريخ الميلاد",
        alertInvalid: "الرجاء التأكد من صحة تاريخ/وقت الميلاد",
        alertFuture: "تاريخ/وقت الميلاد لا يمكن أن يكون في المستقبل",

        timeEmpty: `سيتم اعتبار الوقت <b>00:00:00</b> إذا تركته فارغًا.`,
        titleFor: (name) => `العمر المباشر لـ ${name}`,

        // Share texts
        shareModalTitle: "مشاركة",
        shareHint: "اختر طريقة المشاركة:",
        copy: "نسخ",
        copied: "تم النسخ",
        shareText: (hijri) => `جرّبها! عمري الآن هون:\n\nالموافق على الهجري: ${hijri}`,

        // Seasons
        seasonWinter: "الشتاء",
        seasonSpring: "الربيع",
        seasonSummer: "الصيف",
        seasonAutumn: "الخريف",

        // Sleep
        sleepChild: "حسب عمرك: الأطفال يحتاجون ساعات أكثر.",
        sleepTeen: "حوالي 8–10 ساعات يوميًا.",
        sleepAdult: "حوالي 7–9 ساعات يوميًا.",
        sleepOlder: "حوالي 7–8 ساعات يوميًا.",

        // Date helpers
        dayNames: ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],
        monthsG: ["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],

        // Zodiac names
        zodiac: {
          aries:"الحمل", taurus:"الثور", gemini:"الجوزاء", cancer:"السرطان", leo:"الأسد", virgo:"العذراء",
          libra:"الميزان", scorpio:"العقرب", sagittarius:"القوس", capricorn:"الجدي", aquarius:"الدلو", pisces:"الحوت"
        }
      },

      en: {
        langLabel: "Language",
        shareBtn: "Share",
        titleBase: "Live Age Calculator",
        subnote: `Enter birth date and time, then watch your age update every second.<br>(Years/months are approximate — days/hours/minutes/seconds are exact)`,
        lblName: "Name",
        phName: "Enter name",
        hintName: "Optional. If empty, the general title will be shown without a name.",
        lblBirthDate: "Birth date",
        hintBirthDate: "Required. Choose the date from the calendar.",
        lblBirthTime: "Birth time",
        hintBirthTime: `Optional. If empty, time will be set to <b>00:00:00</b>.<br>Input is usually <b>24-hour</b> format: e.g., <b>07:30</b> (AM) or <b>19:30</b> (PM).`,
        btnStart: "Calculate",
        btnReset: "Clear",
        secLiveTitle: "Your age now",
        rYears: "Years (approx.)",
        rMonths: "Months (approx.)",
        rWeeks: "Weeks",
        rDays: "Days",
        rHours: "Hours",
        rMinutes: "Minutes",
        rSeconds: "Seconds",

        nbTitle: "Next birthday",
        nbRemainingK: "Time left until your next birthday:",
        nbWillBeK: "Your birthday will be on:",
        nbHijriK: "Hijri equivalent:",

        hTitle: "Hijri calendar (Umm al-Qura)",
        hBirthDateK: "Birth date:",
        hBirthMonthK: "Birth month:",
        hAgeK: "Age:",
        hHint: "Calculated using the Umm al-Qura calendar.",

        miTitle: "More about your age",
        miBornDayK: "Born on:",
        miSeasonK: "Born in season:",
        miZodiacK: "Zodiac sign:",
        miSleepK: "Healthy sleep:",

        usefulLinks: "Useful links:",
        lnkAbout: "About",
        lnkPrivacy: "Privacy Policy",
        lnkContact: "Contact",
        sumAbout: "About",
        aboutText: "A lightweight tool to calculate age in real time by entering birth date and time. Works smoothly on mobile and desktop.",
        sumContact: "Contact",
        contactIntro: "For suggestions or feedback, reach me via:",
        cNameLbl: "Name:",
        cRoleLbl: "Role:",
        cEmailLbl: "Email:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profile",

        alertNeedDate: "Please enter your birth date",
        alertInvalid: "Please check the birth date/time values",
        alertFuture: "Birth date/time cannot be in the future",

        timeEmpty: `If left empty, time will be set to <b>00:00:00</b>.`,
        titleFor: (name) => `Live age for ${name}`,

        shareModalTitle: "Share",
        shareHint: "Choose a sharing method:",
        copy: "Copy",
        copied: "Copied",
        shareText: (hijri) => `Try it! My age is here:\n\nHijri date: ${hijri}`,

        seasonWinter: "Winter",
        seasonSpring: "Spring",
        seasonSummer: "Summer",
        seasonAutumn: "Autumn",

        sleepChild: "Depends on age: kids need more sleep.",
        sleepTeen: "About 8–10 hours per day.",
        sleepAdult: "About 7–9 hours per day.",
        sleepOlder: "About 7–8 hours per day.",

        dayNames: ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],
        monthsG: ["January","February","March","April","May","June","July","August","September","October","November","December"],

        zodiac: {
          aries:"Aries", taurus:"Taurus", gemini:"Gemini", cancer:"Cancer", leo:"Leo", virgo:"Virgo",
          libra:"Libra", scorpio:"Scorpio", sagittarius:"Sagittarius", capricorn:"Capricorn", aquarius:"Aquarius", pisces:"Pisces"
        }
      },

      tr: {
        langLabel: "Dil",
        shareBtn: "Paylaş",
        titleBase: "Canlı Yaş Hesaplayıcı",
        subnote: `Doğum tarihi ve saatini girin, yaşınız her saniye güncellensin.<br>(Yıl/ay yaklaşık — gün/saat/dakika/saniye kesin)`,
        lblName: "İsim",
        phName: "İsim girin",
        hintName: "İsteğe bağlı. Boş bırakırsanız genel başlık gösterilir.",
        lblBirthDate: "Doğum tarihi",
        hintBirthDate: "Gerekli. Takvimden tarih seçin.",
        lblBirthTime: "Doğum saati",
        hintBirthTime: `İsteğe bağlı. Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.<br>Giriş genelde <b>24 saat</b> formatıdır: örn. <b>07:30</b> (AM) veya <b>19:30</b> (PM).`,
        btnStart: "Hesapla",
        btnReset: "Temizle",
        secLiveTitle: "Şu anki yaşın",
        rYears: "Yıl (yaklaşık)",
        rMonths: "Ay (yaklaşık)",
        rWeeks: "Hafta",
        rDays: "Gün",
        rHours: "Saat",
        rMinutes: "Dakika",
        rSeconds: "Saniye",

        nbTitle: "Bir sonraki doğum günün",
        nbRemainingK: "Doğum gününe kalan süre:",
        nbWillBeK: "Doğum günün şu gün olacak:",
        nbHijriK: "Hicri karşılığı:",

        hTitle: "Hicri takvim (Umm al-Qura)",
        hBirthDateK: "Doğum tarihi:",
        hBirthMonthK: "Doğum ayı:",
        hAgeK: "Yaş:",
        hHint: "Hesaplama Umm al-Qura takvimine göre yapılır.",

        miTitle: "Yaşın hakkında daha fazla",
        miBornDayK: "Doğduğun gün:",
        miSeasonK: "Doğduğun mevsim:",
        miZodiacK: "Burcun:",
        miSleepK: "Sağlıklı uyku:",

        usefulLinks: "Bağlantılar:",
        lnkAbout: "Hakkında",
        lnkPrivacy: "Gizlilik Politikası",
        lnkContact: "İletişim",
        sumAbout: "Hakkında",
        aboutText: "Doğum tarihi ve saatini girerek yaşınızı gerçek zamanlı hesaplayan hafif bir araç. Mobil ve masaüstünde sorunsuz çalışır.",
        sumContact: "İletişim",
        contactIntro: "Öneri veya geri bildirim için şu kanallardan ulaşabilirsiniz:",
        cNameLbl: "İsim:",
        cRoleLbl: "Unvan:",
        cEmailLbl: "E-posta:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profil",

        alertNeedDate: "Lütfen doğum tarihinizi girin",
        alertInvalid: "Lütfen doğum tarihi/saat değerlerini kontrol edin",
        alertFuture: "Doğum tarihi/saat gelecekte olamaz",

        timeEmpty: `Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.`,
        titleFor: (name) => `${name} için canlı yaş`,

        shareModalTitle: "Paylaş",
        shareHint: "Paylaşım yöntemini seçin:",
        copy: "Kopyala",
        copied: "Kopyalandı",
        shareText: (hijri) => `Dene! Şu anki yaşım burada:\n\nHicri tarih: ${hijri}`,

        seasonWinter: "Kış",
        seasonSpring: "İlkbahar",
        seasonSummer: "Yaz",
        seasonAutumn: "Sonbahar",

        sleepChild: "Yaşa göre değişir: çocuklar daha fazla uyur.",
        sleepTeen: "Günde yaklaşık 8–10 saat.",
        sleepAdult: "Günde yaklaşık 7–9 saat.",
        sleepOlder: "Günde yaklaşık 7–8 saat.",

        dayNames: ["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"],
        monthsG: ["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],

        zodiac: {
          aries:"Koç", taurus:"Boğa", gemini:"İkizler", cancer:"Yengeç", leo:"Aslan", virgo:"Başak",
          libra:"Terazi", scorpio:"Akrep", sagittarius:"Yay", capricorn:"Oğlak", aquarius:"Kova", pisces:"Balık"
        }
      }
    };

    const LANG_META = {
      ar: { dir: "rtl", lang: "ar" },
      en: { dir: "ltr", lang: "en" },
      tr: { dir: "ltr", lang: "tr" }
    };

    let currentLang = "ar";

    // ====== Helpers: language selection ======
    function pickInitialLanguage(){
      const saved = localStorage.getItem(STORAGE_KEYS.lang);
      if (saved && I18N[saved]) return saved;

      const urlLang = new URLSearchParams(window.location.search).get("lang");
      if (urlLang && I18N[urlLang]) return urlLang;

      const langs = (navigator.languages && navigator.languages.length)
        ? navigator.languages
        : [navigator.language || "en"];

      const lc = langs.map(x => String(x).toLowerCase());
      if (lc.some(x => x.startsWith("ar"))) return "ar";
      if (lc.some(x => x.startsWith("tr"))) return "tr";
      return "en";
    }

    function setLanguage(lang){
      if (!I18N[lang]) lang = "ar";
      currentLang = lang;
      localStorage.setItem(STORAGE_KEYS.lang, lang);

      // html lang/dir
      document.documentElement.lang = LANG_META[lang].lang;
      document.documentElement.dir = LANG_META[lang].dir;

      const t = I18N[lang];

      $("uiLangLabel").textContent = t.langLabel;
      $("shareBtnText").textContent = t.shareBtn;

      $("title").textContent = t.titleBase;
      $("subnote").innerHTML = t.subnote;

      $("lblName").textContent = t.lblName;
      $("name").placeholder = t.phName;
      $("hintName").textContent = t.hintName;

      $("lblBirthDate").textContent = t.lblBirthDate;
      $("hintBirthDate").textContent = t.hintBirthDate;

      $("lblBirthTime").textContent = t.lblBirthTime;
      $("hintBirthTime").innerHTML = t.hintBirthTime;

      $("btnStart").textContent = t.btnStart;
      $("btnReset").textContent = t.btnReset;

      $("secLiveTitle").textContent = t.secLiveTitle;
      $("rYears").textContent = t.rYears;
      $("rMonths").textContent = t.rMonths;
      $("rWeeks").textContent = t.rWeeks;
      $("rDays").textContent = t.rDays;
      $("rHours").textContent = t.rHours;
      $("rMinutes").textContent = t.rMinutes;
      $("rSeconds").textContent = t.rSeconds;

      $("nbTitle").textContent = t.nbTitle;
      $("nbRemainingK").textContent = t.nbRemainingK;
      $("nbWillBeK").textContent = t.nbWillBeK;
      $("nbHijriK").textContent = t.nbHijriK;

      $("hTitle").textContent = t.hTitle;
      $("hBirthDateK").textContent = t.hBirthDateK;
      $("hBirthMonthK").textContent = t.hBirthMonthK;
      $("hAgeK").textContent = t.hAgeK;
      $("hHint").textContent = t.hHint;

      $("miTitle").textContent = t.miTitle;
      $("miBornDayK").textContent = t.miBornDayK;
      $("miSeasonK").textContent = t.miSeasonK;
      $("miZodiacK").textContent = t.miZodiacK;
      $("miSleepK").textContent = t.miSleepK;

      $("usefulLinks").textContent = t.usefulLinks;
      $("lnkAbout").textContent = t.lnkAbout;
      $("lnkPrivacy").textContent = t.lnkPrivacy;
      $("lnkContact").textContent = t.lnkContact;

      $("sumAbout").textContent = t.sumAbout;
      $("aboutText").textContent = t.aboutText;

      $("sumContact").textContent = t.sumContact;
      $("contactIntro").textContent = t.contactIntro;

      $("cNameLbl").textContent = t.cNameLbl;
      $("cRoleLbl").textContent = t.cRoleLbl;
      $("cEmailLbl").textContent = t.cEmailLbl;
      $("cLinkedLbl").textContent = t.cLinkedLbl;
      $("cLinkedText").textContent = t.cLinkedText;

      // modal translations
      $("shareModalTitle").textContent = t.shareModalTitle;
      $("shareHint").textContent = t.shareHint;
      $("copyBtn").textContent = t.copy;

      // update previews
      updateTimePreview();
      updateDynamicTitle();
    }

    function updateDynamicTitle(){
      const name = ($("name").value || "").trim();
      const t = I18N[currentLang];
      const isVisible = $("result").style.display === "block";

      if (!isVisible){
        $("title").textContent = t.titleBase;
        return;
      }
      $("title").textContent = name ? t.titleFor(name) : t.titleBase;
    }

    // ====== Save / Restore ======
    function saveInputs(){
      localStorage.setItem(STORAGE_KEYS.name, $("name").value || "");
      localStorage.setItem(STORAGE_KEYS.date, $("birthDate").value || "");
      localStorage.setItem(STORAGE_KEYS.time, $("birthTime").value || "");
    }

    function restoreInputs(){
      $("name").value = localStorage.getItem(STORAGE_KEYS.name) || "";
      $("birthDate").value = localStorage.getItem(STORAGE_KEYS.date) || "";
      $("birthTime").value = localStorage.getItem(STORAGE_KEYS.time) || "";
    }

    // ====== Time preview ======
    function updateTimePreview(){
      const preview = $("timePreview");
      if (!preview) return;

      const t = I18N[currentLang];
      const timeVal = ($("birthTime").value || "").trim();

      if (!timeVal){
        preview.innerHTML = t.timeEmpty;
        return;
      }

      const parts = timeVal.split(":").map(Number);
      const hh24 = parts[0] ?? 0;
      const mm = parts[1] ?? 0;

      const isPM = hh24 >= 12;
      let hh12 = hh24 % 12;
      if (hh12 === 0) hh12 = 12;

      const ampm = isPM ? "PM" : "AM";
      const mm2 = String(mm).padStart(2, "0");
      preview.textContent = `${timeVal} = ${hh12}:${mm2} ${ampm}`;
    }

    // ====== Core date building (interpreted as TR wall-time, represented in UTC timestamp) ======
    function buildWallTRTimestamp(dateStr, timeStr){
      // dateStr: YYYY-MM-DD
      const parts = (dateStr || "").split("-").map(Number);
      if (parts.length !== 3 || parts.some(Number.isNaN)) return null;

      const t = (timeStr && timeStr.trim()) ? timeStr.trim() : "00:00:00";
      const tParts = t.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mm = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      const y = parts[0], m = parts[1], d = parts[2];
      const ts = Date.UTC(y, m - 1, d, hh, mm, ss);
      if (Number.isNaN(ts)) return null;
      return ts;
    }

    function nowWallTRTimestamp(){
      // Now, but represented as "TR wall-time" in UTC axis
      const n = new Date();
      return Date.UTC(
        n.getUTCFullYear(), n.getUTCMonth(), n.getUTCDate(),
        n.getUTCHours(), n.getUTCMinutes(), n.getUTCSeconds()
      );
    }

    function wallDateFromTs(ts){
      // Treat ts as UTC and format/display with timeZone UTC
      return new Date(ts);
    }

    function formatGregorian(ts, withTime){
      const t = I18N[currentLang];
      const d = wallDateFromTs(ts);
      const y = d.getUTCFullYear();
      const m = d.getUTCMonth();
      const da = d.getUTCDate();
      const hh = d.getUTCHours();
      const mm = d.getUTCMinutes();

      const monthName = t.monthsG[m];

      if (currentLang === "en"){
        const base = `${monthName} ${da}, ${y}`;
        if (!withTime) return base;
        const hh2 = String(hh).padStart(2,"0");
        const mm2 = String(mm).padStart(2,"0");
        return `${base} ${hh2}:${mm2}`;
      }

      if (currentLang === "tr"){
        const base = `${da} ${monthName} ${y}`;
        if (!withTime) return base;
        const hh2 = String(hh).padStart(2,"0");
        const mm2 = String(mm).padStart(2,"0");
        return `${base} ${hh2}:${mm2}`;
      }

      // ar
      const base = `${da} ${monthName} ${y}`;
      if (!withTime) return base;
      // display 12h with AM/PM in Arabic context? Keep 24h to avoid confusion
      const hh2 = String(hh).padStart(2,"0");
      const mm2 = String(mm).padStart(2,"0");
      return `${base} ${hh2}:${mm2}`;
    }

    function weekdayName(ts){
      const t = I18N[currentLang];
      const d = wallDateFromTs(ts);
      const wd = d.getUTCDay(); // 0..6
      return t.dayNames[wd];
    }

    // ====== Hijri (Umm al-Qura) ======
    function hijriPartsFromTS(ts){
      // Using Intl with islamic-umalqura; formatToParts to extract Y/M/D and month name
      const locale = (currentLang === "ar") ? "ar-SA-u-ca-islamic-umalqura" :
                     (currentLang === "tr") ? "tr-TR-u-ca-islamic-umalqura" :
                     "en-US-u-ca-islamic-umalqura";

      const d = wallDateFromTs(ts);

      const fmt = new Intl.DateTimeFormat(locale, {
        timeZone: TZ_WALL,
        year: "numeric",
        month: "long",
        day: "numeric"
      });

      const parts = fmt.formatToParts(d);
      const out = { day:"", monthName:"", year:"" };
      for (const p of parts){
        if (p.type === "day") out.day = p.value;
        if (p.type === "month") out.monthName = p.value;
        if (p.type === "year") out.year = p.value;
      }
      return out;
    }

    function hijriString(ts){
      const p = hijriPartsFromTS(ts);
      // Arabic style: "12 رمضان 1447 هـ"
      if (currentLang === "ar") return `${p.day} ${p.monthName} ${p.year} هـ`;
      if (currentLang === "tr") return `${p.day} ${p.monthName} ${p.year}`;
      return `${p.monthName} ${p.day}, ${p.year}`;
    }

    // ====== Zodiac ======
    function zodiacKey(month, day){
      // month: 1..12
      // Aries Mar21-Apr19 etc
      if ((month===3 && day>=21) || (month===4 && day<=19)) return "aries";
      if ((month===4 && day>=20) || (month===5 && day<=20)) return "taurus";
      if ((month===5 && day>=21) || (month===6 && day<=20)) return "gemini";
      if ((month===6 && day>=21) || (month===7 && day<=22)) return "cancer";
      if ((month===7 && day>=23) || (month===8 && day<=22)) return "leo";
      if ((month===8 && day>=23) || (month===9 && day<=22)) return "virgo";
      if ((month===9 && day>=23) || (month===10 && day<=22)) return "libra";
      if ((month===10 && day>=23) || (month===11 && day<=21)) return "scorpio";
      if ((month===11 && day>=22) || (month===12 && day<=21)) return "sagittarius";
      if ((month===12 && day>=22) || (month===1 && day<=19)) return "capricorn";
      if ((month===1 && day>=20) || (month===2 && day<=18)) return "aquarius";
      return "pisces";
    }

    // ====== Season (Northern Hemisphere) ======
    function seasonName(month){
      const t = I18N[currentLang];
      // DJF winter, MAM spring, JJA summer, SON autumn
      if ([12,1,2].includes(month)) return t.seasonWinter;
      if ([3,4,5].includes(month)) return t.seasonSpring;
      if ([6,7,8].includes(month)) return t.seasonSummer;
      return t.seasonAutumn;
    }

    // ====== Sleep recommendation (simple, by age years approx) ======
    function sleepText(ageYears){
      const t = I18N[currentLang];
      if (ageYears < 13) return t.sleepChild;
      if (ageYears < 18) return t.sleepTeen;
      if (ageYears < 65) return t.sleepAdult;
      return t.sleepOlder;
    }

    // ====== Countdown formatting (RTL safe) ======
    function formatCountdown(ms){
      const t = I18N[currentLang];
      const sign = ms < 0 ? "-" : "";
      ms = Math.abs(ms);

      const days = Math.floor(ms / MS_DAY);
      ms -= days * MS_DAY;
      const hours = Math.floor(ms / MS_HR);
      ms -= hours * MS_HR;
      const mins = Math.floor(ms / MS_MIN);
      ms -= mins * MS_MIN;
      const secs = Math.floor(ms / MS_SEC);

      if (currentLang === "en"){
        const parts = [];
        if (days) parts.push(`${days} day${days!==1?"s":""}`);
        if (hours) parts.push(`${hours} hour${hours!==1?"s":""}`);
        if (mins) parts.push(`${mins} minute${mins!==1?"s":""}`);
        parts.push(`${secs} second${secs!==1?"s":""}`);
        return sign + parts.join(", ");
      }

      if (currentLang === "tr"){
        const parts = [];
        if (days) parts.push(`${days} gün`);
        if (hours) parts.push(`${hours} saat`);
        if (mins) parts.push(`${mins} dakika`);
        parts.push(`${secs} saniye`);
        return sign + parts.join(" ");
      }

      // ar
      const parts = [];
      if (days) parts.push(`${days} يوم`);
      if (hours) parts.push(`${hours} ساعة`);
      if (mins) parts.push(`${mins} دقيقة`);
      parts.push(`${secs} ثانية`);
      return sign + parts.join(" و ");
    }

    // ====== Next birthday (TR wall-time) ======
    function nextBirthdayTs(birthTs){
      const d = wallDateFromTs(birthTs);
      const by = d.getUTCFullYear();
      const bm = d.getUTCMonth() + 1;
      const bd = d.getUTCDate();
      const bh = d.getUTCHours();
      const bmin = d.getUTCMinutes();
      const bs = d.getUTCSeconds();

      const nowTs = nowWallTRTimestamp();
      const nowD = wallDateFromTs(nowTs);
      const ny = nowD.getUTCFullYear();

      let cand = Date.UTC(ny, bm-1, bd, bh, bmin, bs);
      if (cand <= nowTs) cand = Date.UTC(ny+1, bm-1, bd, bh, bmin, bs);
      return cand;
    }

    // ====== Hijri age approximation (based on days difference) ======
    function hijriAgeApprox(birthTs, nowTs){
      // Use 354.367 days per Hijri year (approx) and 29.5306 per month (approx)
      const diffDays = Math.floor((nowTs - birthTs) / MS_DAY);
      const hijriYears = Math.floor(diffDays / 354.367);
      const remDays = diffDays - Math.floor(hijriYears * 354.367);
      const hijriMonths = Math.floor(remDays / 29.5306);
      const hijriDays = remDays - Math.floor(hijriMonths * 29.5306);

      return { hijriYears, hijriMonths, hijriDays };
    }

    // ====== Share ======
    function siteUrl(){
      return "https://tarekja.github.io/";
    }

    function buildShareSummary(){
      const t = I18N[currentLang];
      const url = siteUrl();

      if ($("result").style.display !== "block"){
        // Basic share if no result
        const text =
          (currentLang === "ar") ? "جرّبها! حاسبة العمر المباشر." :
          (currentLang === "tr") ? "Dene! Canlı yaş hesaplayıcı." :
          "Try it! Live Age Calculator.";
        return { title: t.titleBase, text, url };
      }

      const hijri = ($("hBirthDateV").textContent || "").trim();
      const text = t.shareText(hijri);
      return { title: t.titleBase, text, url };
    }

    function openShareFallback(){
      const t = I18N[currentLang];
      const data = buildShareSummary();

      $("shareModal").style.display = "flex";
      $("shareModalTitle").textContent = t.shareModalTitle;
      $("shareHint").textContent = t.shareHint;

      const preview = `${data.text}\n\n${data.url}`;
      $("sharePreview").textContent = preview;

      const encoded = encodeURIComponent(preview);
      const encodedUrl = encodeURIComponent(data.url);

      // WhatsApp: message text (includes url)
      $("shareWhatsApp").href = `https://wa.me/?text=${encoded}`;

      // Facebook: share link only (best practice)
      $("shareFacebook").href = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;

      // X: text + url
      $("shareX").href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(data.text)}&url=${encodedUrl}`;

      $("copyBtn").textContent = t.copy;
    }

    async function doShare(){
      const data = buildShareSummary();

      // Web Share if available
      if (navigator.share){
        try{
          await navigator.share({ title: data.title, text: data.text, url: data.url });
          return;
        }catch(e){
          // fallback if user cancels or fails
        }
      }
      openShareFallback();
    }

    function closeShareModal(){
      $("shareModal").style.display = "none";
    }

    async function copyShare(){
      const t = I18N[currentLang];
      const data = buildShareSummary();
      const txt = `${data.text}\n\n${data.url}`;

      try{
        await navigator.clipboard.writeText(txt);
        $("copyBtn").textContent = t.copied;
        setTimeout(() => $("copyBtn").textContent = t.copy, 1200);
      }catch(e){
        // fallback: select text in preview is enough
        $("copyBtn").textContent = t.copy;
      }
    }

    // ====== App logic ======
    let _birthTs = null;

    function resetApp(){
      if (interval) {
        clearInterval(interval);
        interval = null;
      }

      $("result").style.display = "none";
      ["years","months","weeks","days","hours","minutes","seconds"].forEach(id => $(id).textContent = "");

      $("nbRemainingV").textContent = "";
      $("nbWillBeV").textContent = "";
      $("nbHijriV").textContent = "";

      $("hBirthDateV").textContent = "";
      $("hBirthMonthV").textContent = "";
      $("hAgeV").textContent = "";

      $("miBornDayV").textContent = "";
      $("miSeasonV").textContent = "";
      $("miZodiacV").textContent = "";
      $("miSleepV").textContent = "";

      $("name").value = "";
      $("birthDate").value = "";
      $("birthTime").value = "";

      localStorage.removeItem(STORAGE_KEYS.name);
      localStorage.removeItem(STORAGE_KEYS.date);
      localStorage.removeItem(STORAGE_KEYS.time);

      _birthTs = null;
      updateTimePreview();
      setLanguage(currentLang);
    }

    function start(){
      const t = I18N[currentLang];

      const name = ($("name").value || "").trim();
      const date = $("birthDate").value;
      const time = $("birthTime").value || "00:00:00";

      if (!date){
        alert(t.alertNeedDate);
        return;
      }

      const birthTs = buildWallTRTimestamp(date, time);
      if (!birthTs){
        alert(t.alertInvalid);
        return;
      }

      const nowTs = nowWallTRTimestamp();
      if (birthTs > nowTs){
        alert(t.alertFuture);
        return;
      }

      _birthTs = birthTs;

      saveInputs();
      $("result").style.display = "block";
      updateDynamicTitle();

      if (interval) clearInterval(interval);

      function refreshAll(){
        const now = nowWallTRTimestamp();
        let diffMs = now - _birthTs;
        if (diffMs < 0) diffMs = 0;

        const seconds = Math.floor(diffMs / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours   = Math.floor(minutes / 60);
        const days    = Math.floor(hours / 24);
        const weeks   = Math.floor(days / 7);

        const yearsApprox  = diffMs / (1000 * 60 * 60 * 24 * 365.2425);
        const monthsApprox = yearsApprox * 12;

        $("years").textContent    = yearsApprox.toFixed(6);
        $("months").textContent   = monthsApprox.toFixed(2);
        $("weeks").textContent    = weeks.toLocaleString();
        $("days").textContent     = days.toLocaleString();
        $("hours").textContent    = hours.toLocaleString();
        $("minutes").textContent  = minutes.toLocaleString();
        $("seconds").textContent  = seconds.toLocaleString();

        // Next birthday section
        const nbTs = nextBirthdayTs(_birthTs);
        const remaining = nbTs - now;

        $("nbRemainingV").textContent = formatCountdown(remaining);
        const wd = weekdayName(nbTs);
        const dateStr = formatGregorian(nbTs, true);
        // Fix duplication: ONLY one weekday
        $("nbWillBeV").textContent = `${wd} — ${dateStr}`;
        $("nbHijriV").textContent = hijriString(nbTs);

        // Hijri section
        const hb = hijriPartsFromTS(_birthTs);
        $("hBirthDateV").textContent = hijriString(_birthTs);
        $("hBirthMonthV").textContent = hb.monthName;

        const ha = hijriAgeApprox(_birthTs, now);
        if (currentLang === "en"){
          $("hAgeV").textContent = `${ha.hijriYears} year(s), ${ha.hijriMonths} month(s), ${ha.hijriDays} day(s)`;
        } else if (currentLang === "tr"){
          $("hAgeV").textContent = `${ha.hijriYears} yıl ${ha.hijriMonths} ay ${ha.hijriDays} gün`;
        } else {
          $("hAgeV").textContent = `${ha.hijriYears} سنة و ${ha.hijriMonths} شهر و ${ha.hijriDays} يوم`;
        }

        // More info
        const bd = wallDateFromTs(_birthTs);
        const gMonth = bd.getUTCMonth() + 1;
        const gDay = bd.getUTCDate();

        const bornWD = weekdayName(_birthTs);
        const bornStr = formatGregorian(_birthTs, true);
        // Fix duplication: weekday once
        $("miBornDayV").textContent = `${bornWD} — ${bornStr}`;

        $("miSeasonV").textContent = seasonName(gMonth);

        const zKey = zodiacKey(gMonth, gDay);
        $("miZodiacV").textContent = I18N[currentLang].zodiac[zKey];

        $("miSleepV").textContent = sleepText(yearsApprox);
      }

      refreshAll();
      interval = setInterval(refreshAll, 1000);
    }

    // ====== Events / DOM ready ======
    document.addEventListener("DOMContentLoaded", () => {
      // prevent future date selection
      const today = new Date().toISOString().split("T")[0];
      $("birthDate").setAttribute("max", today);

      // Restore
      restoreInputs();

      // Language
      currentLang = pickInitialLanguage();
      $("langSelect").value = currentLang;
      setLanguage(currentLang);

      $("langSelect").addEventListener("change", (e) => setLanguage(e.target.value));

      // Time preview
      updateTimePreview();
      $("birthTime").addEventListener("input", updateTimePreview);

      // Auto-save + title update
      ["name","birthDate","birthTime"].forEach(id => {
        $(id).addEventListener("input", () => {
          saveInputs();
          updateDynamicTitle();
        });
      });

      // Buttons
      $("btnStart").addEventListener("click", start);
      $("btnReset").addEventListener("click", resetApp);

      // Footer anchor open
      $("lnkAbout").addEventListener("click", (e) => { e.preventDefault(); $("about").open = true; $("about").scrollIntoView({behavior:"smooth", block:"start"}); });
      $("lnkContact").addEventListener("click", (e) => { e.preventDefault(); $("contact").open = true; $("contact").scrollIntoView({behavior:"smooth", block:"start"}); });

      // Share
      $("shareBtn").addEventListener("click", doShare);
      $("shareCloseBtn").addEventListener("click", closeShareModal);
      $("shareModal").addEventListener("click", (e) => { if (e.target === $("shareModal")) closeShareModal(); });
      $("copyBtn").addEventListener("click", copyShare);

      // Auto-start if date exists
      if (($("birthDate").value || "").trim()){
        start();
      }
    });
  </script>
</body>
</html>
