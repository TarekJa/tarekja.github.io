<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="حاسبة العمر المباشر بالثواني والدقائق والساعات والأيام. أدخل تاريخ ووقت الميلاد وشاهد العمر يتحدث لحظيًا.">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0f172a">

  <link rel="canonical" href="https://tarekja.github.io/">
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon-512.png">

  <meta property="og:title" content="Live Age Calculator | حاسبة العمر المباشر">
  <meta property="og:description" content="احسب عمرك بشكل مباشر بالسنوات والأشهر والأيام والساعات والدقائق والثواني.">
  <meta property="og:url" content="https://tarekja.github.io/">
  <meta property="og:type" content="website">

  <!-- Google Analytics (مرة واحدة فقط) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ91MD319E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FZ91MD319E', { anonymize_ip: true });
  </script>

  <!-- Google AdSense -->
  <meta name="google-adsense-account" content="ca-pub-3878960602510145">
  <script async
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3878960602510145"
          crossorigin="anonymous"></script>

  <title>Live Age Calculator | حاسبة العمر المباشر</title>

  <style>
    :root{
      --bg:#0f172a;
      --panel:#020617;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --line:#1e293b;
      --chip:#0b1220;
    }
    :root { color-scheme: dark; }

    body{
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin:0;
      padding:0;
    }

    .page{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 18px 10px;
    }

    .container{
      width: min(620px, 94vw);
      margin: 0 auto;
    }

    .box{
      background: var(--panel);
      padding: 22px;
      border-radius:16px;
      box-shadow:0 0 40px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.04);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }

    .lang-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 13px;
    }

    select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      outline:none;
      cursor:pointer;
    }
    option{ background: var(--chip); color: var(--text); }

    h1{
      text-align:center;
      margin:0 0 10px 0;
      font-size:22px;
      color: var(--accent);
      letter-spacing: 0.2px;
    }

    .subnote{
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      margin: 0 0 14px 0;
      line-height: 1.55;
    }

    .grid{
      display:grid;
      gap: 12px;
    }

    .field{ margin-bottom: 12px; }

    label{
      display:block;
      margin-bottom:5px;
      color: var(--muted);
      font-size:14px;
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.55;
    }

    input{
      width:100%;
      padding: 10px;
      border-radius:10px;
      border: 1px solid transparent;
      outline: none;
      font-size:14px;
      box-sizing: border-box;
      background: rgba(255,255,255,0.95);
      color: #0b1220;
    }
    input:focus{
      border-color: rgba(56,189,248,0.55);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.12);
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }

    button{
      border:none;
      cursor:pointer;
      border-radius:10px;
      padding:10px 12px;
      font-size:15px;
    }
    .btn{
      flex:1;
      background: var(--accent);
      color:#0b1220;
      font-weight: bold;
    }
    .btn.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid var(--line);
      font-weight: normal;
    }
    button:hover{ opacity:0.94; }

    /* Share button (icon) */
    .share-row{
      margin-top: 12px;
      display:flex;
      justify-content:center;
    }
    .share-btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      border-radius: 999px;
      font-size: 14px;
      line-height: 1;
    }
    .share-btn svg{ width:18px; height:18px; fill: var(--text); opacity:0.95; }

    /* Sections */
    .section{
      margin-top: 14px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      border-radius: 14px;
      padding: 14px;
    }
    .section-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .section-title .badge{
      font-weight: normal;
      color: var(--muted);
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 4px 8px;
      border-radius: 999px;
    }

    .rows{
      display:grid;
      gap: 8px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(255,255,255,0.10);
      font-size: 14px;
    }
    .row:last-child{ border-bottom:none; }

    .label{ color: var(--muted); }
    .value{
      font-weight:bold;
      color: var(--text);
      text-align:left;
      direction:ltr;
      white-space: nowrap;
    }
    html[dir="rtl"] .value{ text-align:left; } /* keep numbers LTR */

    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.8;
      text-align:center;
    }
    .footer a{ color: var(--accent); text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }

    details{
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(2,6,23,0.35);
      text-align: start;
    }
    summary{
      cursor: pointer;
      color: var(--text);
      font-weight: bold;
    }
    details p{
      margin: 10px 0 0 0;
      color: var(--muted);
      font-weight: normal;
    }

    /* Share panel fallback */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 50;
    }
    .modal.open{ display:flex; }
    .modal-card{
      width: min(520px, 96vw);
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 12px 50px rgba(0,0,0,0.75);
    }
    .modal-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .modal-title{
      font-weight: bold;
      color: var(--text);
    }
    .xbtn{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text);
      border-radius: 10px;
      padding: 6px 10px;
      cursor:pointer;
    }
    .share-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .share-chip{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
      text-align:center;
      font-size: 14px;
    }
    .share-chip:hover{ opacity:0.95; }
    .copybox{
      margin-top: 10px;
      display:flex;
      gap: 10px;
    }
    .copybox input{
      background: rgba(255,255,255,0.95);
      color:#0b1220;
    }
    .toast{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12.5px;
      min-height: 18px;
    }

    @media (max-width: 420px){
      .box{ padding: 16px; }
      h1{ font-size: 20px; }
      .share-grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="box">

        <div class="topbar">
          <div class="lang-wrap">
            <span id="uiLangLabel">اللغة</span>
            <select id="langSelect" aria-label="Language selector">
              <option value="ar">العربية</option>
              <option value="tr">Türkçe</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>

        <h1 id="title">حاسبة العمر المباشر</h1>
        <div class="subnote" id="subnote">
          أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>
          (السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)
        </div>

        <div class="field">
          <label for="name" id="lblName">الاسم</label>
          <input type="text" id="name" placeholder="أدخل الاسم" maxlength="40">
          <div class="hint" id="hintName">اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.</div>
        </div>

        <div class="field">
          <label for="birthDate" id="lblBirthDate">تاريخ الميلاد</label>
          <input type="date" id="birthDate">
          <div class="hint" id="hintBirthDate">مطلوب. اختر التاريخ من التقويم.</div>
        </div>

        <div class="field">
          <label for="birthTime" id="lblBirthTime">ساعة الميلاد</label>
          <input type="time" id="birthTime" step="1">
          <div class="hint" id="hintBirthTime">
            اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>
            عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM صباحًا) أو <b>19:30</b> (PM مساءً).
          </div>
          <div class="hint" id="timePreview"></div>
        </div>

        <div class="actions">
          <button id="btnStart" class="btn" onclick="start()">احسب العمر</button>
          <button id="btnReset" class="secondary" onclick="resetApp()">مسح</button>
        </div>

        <div class="share-row" id="shareRow" style="display:none;">
          <button class="share-btn" id="btnShare" onclick="shareResult()">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M18 16a3 3 0 0 0-2.4 1.2l-6.2-3.1a3 3 0 0 0 0-2.2l6.2-3.1A3 3 0 1 0 15 6a3 3 0 0 0 .1.7L8.9 9.8a3 3 0 1 0 0 4.4l6.2 3.1A3 3 0 1 0 18 16z"/>
            </svg>
            <span id="shareBtnText">مشاركة</span>
          </button>
        </div>

        <!-- النتائج الأساسية -->
        <div class="section" id="liveSection" style="display:none;">
          <div class="section-title">
            <span id="liveTitle">عمرك الآن</span>
            <span class="badge" id="tzBadge">(TR)</span>
          </div>
          <div class="rows">
            <div class="row"><div class="label" id="rYears">السنوات (تقريب)</div><div class="value" id="years"></div></div>
            <div class="row"><div class="label" id="rMonths">الأشهر (تقريب)</div><div class="value" id="months"></div></div>
            <div class="row"><div class="label" id="rWeeks">الأسابيع</div><div class="value" id="weeks"></div></div>
            <div class="row"><div class="label" id="rDays">الأيام</div><div class="value" id="days"></div></div>
            <div class="row"><div class="label" id="rHours">الساعات</div><div class="value" id="hours"></div></div>
            <div class="row"><div class="label" id="rMinutes">الدقائق</div><div class="value" id="minutes"></div></div>
            <div class="row"><div class="label" id="rSeconds">الثواني</div><div class="value" id="seconds"></div></div>
          </div>
        </div>

        <!-- عيد الميلاد القادم -->
        <div class="section" id="bdaySection" style="display:none;">
          <div class="section-title">
            <span id="bdayTitle">عيد ميلادك القادم</span>
            <span class="badge" id="bdayTzBadge">(TR)</span>
          </div>
          <div class="rows">
            <div class="row"><div class="label" id="bdayLeftLbl">باقي لعيد ميلادك القادم:</div><div class="value" id="bdayLeftVal"></div></div>
            <div class="row"><div class="label" id="bdayWillLbl">سيكون عيد ميلادك يوم:</div><div class="value" id="bdayWillVal"></div></div>
            <div class="row"><div class="label" id="bdayHijriLbl">الموافق:</div><div class="value" id="bdayHijriVal"></div></div>
          </div>
        </div>

        <!-- الهجري -->
        <div class="section" id="hijriSection" style="display:none;">
          <div class="section-title">
            <span id="hTitle">العمر حسب التقويم الهجري</span>
            <span class="badge" id="hBadge">Umm al-Qura</span>
          </div>
          <div class="rows">
            <div class="row"><div class="label" id="hBirthLbl">تاريخ الميلاد:</div><div class="value" id="hBirthVal"></div></div>
            <div class="row"><div class="label" id="hMonthLbl">شهر الميلاد:</div><div class="value" id="hMonthVal"></div></div>
            <div class="row"><div class="label" id="hAgeLbl">العمر:</div><div class="value" id="hAgeVal"></div></div>
          </div>
          <div class="hint" id="hHint"></div>
          <div class="hint" id="hDiffHint"></div>
        </div>

        <!-- معلومات إضافية -->
        <div class="section" id="moreSection" style="display:none;">
          <div class="section-title">
            <span id="moreTitle">معلومات أكثر عن عمرك</span>
            <span class="badge" id="moreBadge"></span>
          </div>
          <div class="rows">
            <div class="row"><div class="label" id="bornDayLbl">ولدت يوم:</div><div class="value" id="bornDayVal"></div></div>
            <div class="row"><div class="label" id="bornSeasonLbl">ولدت في فصل:</div><div class="value" id="bornSeasonVal"></div></div>
            <div class="row"><div class="label" id="zodiacLbl">برجك:</div><div class="value" id="zodiacVal"></div></div>
            <div class="row"><div class="label" id="sleepLbl">نومك الصحي:</div><div class="value" id="sleepVal"></div></div>
          </div>
        </div>

        <div class="footer">
          <div>
            <span id="usefulLinks">روابط مفيدة:</span>
            <a href="#about" onclick="openDetails('about')" id="lnkAbout">من نحن</a> ·
            <a href="/privacy.html" id="lnkPrivacy">سياسة الخصوصية</a> ·
            <a href="#contact" onclick="openDetails('contact')" id="lnkContact">تواصل</a>
          </div>

          <details id="about">
            <summary id="sumAbout">من نحن</summary>
            <p id="aboutText">
              هذه أداة بسيطة لحساب العمر بشكل مباشر (Real-time) عبر إدخال تاريخ ووقت الميلاد.
              الهدف هو تقديم تجربة سريعة وخفيفة تعمل على الجوال والكمبيوتر.
            </p>
          </details>

          <details id="contact">
            <summary id="sumContact">تواصل</summary>
            <p id="contactIntro">إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:</p>
            <p>
              <b id="cNameLbl">الاسم:</b> <span id="cNameVal">Tarek Jawish</span><br>
              <b id="cRoleLbl">الصفة:</b> <span id="cRoleVal">MEAL Expert</span><br>
              <b id="cEmailLbl">البريد:</b> <a href="mailto:tarekjawish89@gmail.com">tarekjawish89@gmail.com</a><br>
              <b id="cLinkedLbl">LinkedIn:</b>
              <a href="https://www.linkedin.com/in/tarek-jawish-890998106/" target="_blank" rel="noopener noreferrer" id="cLinkedText">الملف الشخصي</a>
            </p>
          </details>
        </div>

      </div>
    </div>
  </div>

  <!-- Share fallback modal -->
  <div class="modal" id="shareModal" role="dialog" aria-modal="true" aria-label="Share dialog">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title" id="shareModalTitle">مشاركة</div>
        <button class="xbtn" onclick="closeShareModal()">×</button>
      </div>

      <div class="share-grid">
        <button class="share-chip" id="shWhats" onclick="shareTo('whatsapp')">WhatsApp</button>
        <button class="share-chip" id="shX" onclick="shareTo('x')">X</button>
        <button class="share-chip" id="shFB" onclick="shareTo('facebook')">Facebook</button>
        <button class="share-chip" id="shCopy" onclick="copyShare()">Copy</button>
      </div>

      <div class="copybox">
        <input id="shareLink" type="text" readonly value="">
      </div>

      <div class="toast" id="shareToast"></div>
    </div>
  </div>

  <script>
    // =========================
    // Storage / helpers
    // =========================
    let interval = null;

    const STORAGE_KEYS = {
      name: "lac_name",
      date: "lac_birthDate",
      time: "lac_birthTime",
      lang: "lac_lang"
    };

    function $(id){ return document.getElementById(id); }

    function openDetails(id){
      const el = $(id);
      if (el && el.tagName.toLowerCase() === "details"){
        el.open = true;
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function saveInputs(){
      localStorage.setItem(STORAGE_KEYS.name, $("name").value || "");
      localStorage.setItem(STORAGE_KEYS.date, $("birthDate").value || "");
      localStorage.setItem(STORAGE_KEYS.time, $("birthTime").value || "");
    }

    function restoreInputs(){
      $("name").value = localStorage.getItem(STORAGE_KEYS.name) || "";
      $("birthDate").value = localStorage.getItem(STORAGE_KEYS.date) || "";
      $("birthTime").value = localStorage.getItem(STORAGE_KEYS.time) || "";
    }

    // =========================
    // Hijri month names (accurate)
    // =========================
    const HIJRI_MONTHS = {
      ar: ["محرم","صفر","ربيع الأول","ربيع الآخر","جمادى الأولى","جمادى الآخرة","رجب","شعبان","رمضان","شوال","ذو القعدة","ذو الحجة"],
      tr: ["Muharrem","Safer","Rebiülevvel","Rebiülahir","Cemaziyelevvel","Cemaziyelahir","Receb","Şaban","Ramazan","Şevval","Zilkade","Zilhicce"],
      en: ["Muharram","Safar","Rabiʿ al-Awwal","Rabiʿ al-Thani","Jumada al-Ula","Jumada al-Akhirah","Rajab","Shaʿban","Ramadan","Shawwal","Dhu al-Qiʿdah","Dhu al-Hijjah"]
    };

    function hijriPartsUmmAlQura(date){
      // Numeric parts (Latin digits) for reliable parsing
      const fmt = new Intl.DateTimeFormat("en-TN-u-ca-islamic-umalqura-nu-latn", {
        year:"numeric", month:"numeric", day:"numeric"
      });
      const parts = fmt.formatToParts(date);
      const get = (type) => {
        const p = parts.find(x => x.type === type);
        return p ? parseInt(p.value, 10) : NaN;
      };
      return { y: get("year"), m: get("month"), d: get("day") };
    }

    function hijriDateText(date, lang){
      const hp = hijriPartsUmmAlQura(date);
      const months = HIJRI_MONTHS[lang] || HIJRI_MONTHS.ar;
      const mName = months[(hp.m || 1) - 1] || months[0];

      if (lang === "ar"){
        return `${hp.d} ${mName} ${hp.y} هـ`;
      }
      if (lang === "tr"){
        return `${hp.d} ${mName} ${hp.y} H`;
      }
      return `${hp.d} ${mName} ${hp.y} AH`;
    }

    // =========================
    // I18N
    // =========================
    const I18N = {
      ar: {
        langLabel: "اللغة",
        titleBase: "حاسبة العمر المباشر",
        subnote: `أدخل تاريخ ووقت الميلاد ثم شاهد العمر يتحدث كل ثانية.<br>(السنوات/الأشهر تقريبية — بينما الأيام/الساعات/الدقائق/الثواني دقيقة)`,
        lblName: "الاسم",
        phName: "أدخل الاسم",
        hintName: "اختياري. إذا تركته فارغًا سيظهر العنوان العام بدون اسم.",
        lblBirthDate: "تاريخ الميلاد",
        hintBirthDate: "مطلوب. اختر التاريخ من التقويم.",
        lblBirthTime: "ساعة الميلاد",
        hintBirthTime: `اختياري. إذا تركته فارغًا سنعتبر الوقت <b>00:00:00</b>.<br>عادةً الإدخال يكون بنظام <b>24 ساعة</b>: مثال <b>07:30</b> (AM صباحًا) أو <b>19:30</b> (PM مساءً).`,
        btnStart: "احسب العمر",
        btnReset: "مسح",
        shareBtn: "مشاركة",
        shareTitle: "مشاركة",
        liveTitle: "عمرك الآن",
        rYears: "السنوات (تقريب)",
        rMonths: "الأشهر (تقريب)",
        rWeeks: "الأسابيع",
        rDays: "الأيام",
        rHours: "الساعات",
        rMinutes: "الدقائق",
        rSeconds: "الثواني",
        bdayTitle: "عيد ميلادك القادم",
        bdayLeftLbl: "باقي لعيد ميلادك القادم:",
        bdayWillLbl: "سيكون عيد ميلادك يوم:",
        bdayHijriLbl: "الموافق:",
        hijriTitle: "العمر حسب التقويم الهجري",
        hBirthLbl: "تاريخ الميلاد:",
        hMonthLbl: "شهر الميلاد:",
        hAgeLbl: "العمر:",
        hHint: "الحساب يعتمد تقويم أم القرى (Umm al-Qura).",
        hDiffHint: "ملاحظة: يختلف العمر بالهجري عن الميلادي لأن السنة الهجرية حوالي 354.36 يومًا، بينما السنة الميلادية حوالي 365.25 يومًا. لذلك يظهر فرق يقارب 11 يومًا لكل سنة، ويزداد هذا الفرق مع مرور الوقت.",
        moreTitle: "معلومات أكثر عن عمرك",
        bornDayLbl: "ولدت يوم:",
        bornSeasonLbl: "ولدت في فصل:",
        zodiacLbl: "برجك:",
        sleepLbl: "نومك الصحي:",
        usefulLinks: "روابط مفيدة:",
        lnkAbout: "من نحن",
        lnkPrivacy: "سياسة الخصوصية",
        lnkContact: "تواصل",
        sumAbout: "من نحن",
        aboutText: "هذه أداة بسيطة لحساب العمر بشكل مباشر (Real-time) عبر إدخال تاريخ ووقت الميلاد. الهدف هو تقديم تجربة سريعة وخفيفة تعمل على الجوال والكمبيوتر.",
        sumContact: "تواصل",
        contactIntro: "إذا عندك اقتراحات أو ملاحظات على الموقع، تواصل معي عبر الوسائل التالية:",
        cNameLbl: "الاسم:",
        cRoleLbl: "الصفة:",
        cEmailLbl: "البريد:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "الملف الشخصي",
        alertNeedDate: "يرجى إدخال تاريخ الميلاد",
        alertInvalid: "الرجاء التأكد من صحة تاريخ/وقت الميلاد",
        alertFuture: "تاريخ/وقت الميلاد لا يمكن أن يكون في المستقبل",
        timeEmpty: `سيتم اعتبار الوقت <b>00:00:00</b> إذا تركته فارغًا.`,
        titleFor: (name) => `العمر المباشر لـ ${name}`,
        // sharing text (short)
        shareMsg: (hijriBirth) => `جربها جميلة! عمري الآن هون:\nالموافق هجريًا: ${hijriBirth}`,
        // seasons
        seasons: { winter:"الشتاء", spring:"الربيع", summer:"الصيف", autumn:"الخريف" },
        // weekdays
        weekday: (date) => new Intl.DateTimeFormat("ar", { weekday:"long" }).format(date),
      },
      en: {
        langLabel: "Language",
        titleBase: "Live Age Calculator",
        subnote: `Enter birth date and time, then watch your age update every second.<br>(Years/months are approximate — days/hours/minutes/seconds are exact)`,
        lblName: "Name",
        phName: "Enter name",
        hintName: "Optional. If empty, the general title will be shown without a name.",
        lblBirthDate: "Birth date",
        hintBirthDate: "Required. Choose the date from the calendar.",
        lblBirthTime: "Birth time",
        hintBirthTime: `Optional. If empty, time will be set to <b>00:00:00</b>.<br>Input is usually <b>24-hour</b> format: e.g., <b>07:30</b> (AM) or <b>19:30</b> (PM).`,
        btnStart: "Calculate",
        btnReset: "Clear",
        shareBtn: "Share",
        shareTitle: "Share",
        liveTitle: "Your age now",
        rYears: "Years (approx.)",
        rMonths: "Months (approx.)",
        rWeeks: "Weeks",
        rDays: "Days",
        rHours: "Hours",
        rMinutes: "Minutes",
        rSeconds: "Seconds",
        bdayTitle: "Next birthday",
        bdayLeftLbl: "Time left until your next birthday:",
        bdayWillLbl: "Your birthday will be on:",
        bdayHijriLbl: "Hijri date:",
        hijriTitle: "Hijri (Umm al-Qura) age",
        hBirthLbl: "Birth date:",
        hMonthLbl: "Birth month:",
        hAgeLbl: "Age:",
        hHint: "Calculated using the Umm al-Qura calendar.",
        hDiffHint: "Note: A Hijri year is about 354.36 days while a Gregorian year is about 365.25 days. This creates ~11 days difference per year, which accumulates over time.",
        moreTitle: "More about you",
        bornDayLbl: "Born on:",
        bornSeasonLbl: "Born in season:",
        zodiacLbl: "Zodiac sign:",
        sleepLbl: "Healthy sleep:",
        usefulLinks: "Useful links:",
        lnkAbout: "About",
        lnkPrivacy: "Privacy Policy",
        lnkContact: "Contact",
        sumAbout: "About",
        aboutText: "A lightweight tool to calculate age in real time by entering birth date and time. Designed to work smoothly on mobile and desktop.",
        sumContact: "Contact",
        contactIntro: "For suggestions or feedback, you can reach me via:",
        cNameLbl: "Name:",
        cRoleLbl: "Role:",
        cEmailLbl: "Email:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profile",
        alertNeedDate: "Please enter your birth date",
        alertInvalid: "Please check the birth date/time values",
        alertFuture: "Birth date/time cannot be in the future",
        timeEmpty: `If left empty, time will be set to <b>00:00:00</b>.`,
        titleFor: (name) => `Live age for ${name}`,
        shareMsg: (hijriBirth) => `Try it! My age is live here:\nHijri equivalent: ${hijriBirth}`,
        seasons: { winter:"Winter", spring:"Spring", summer:"Summer", autumn:"Autumn" },
        weekday: (date) => new Intl.DateTimeFormat("en", { weekday:"long" }).format(date),
      },
      tr: {
        langLabel: "Dil",
        titleBase: "Canlı Yaş Hesaplayıcı",
        subnote: `Doğum tarihi ve saatini girin, yaşınız her saniye güncellensin.<br>(Yıl/ay yaklaşık — gün/saat/dakika/saniye kesin)`,
        lblName: "İsim",
        phName: "İsim girin",
        hintName: "İsteğe bağlı. Boş bırakırsanız genel başlık gösterilir.",
        lblBirthDate: "Doğum tarihi",
        hintBirthDate: "Gerekli. Takvimden tarih seçin.",
        lblBirthTime: "Doğum saati",
        hintBirthTime: `İsteğe bağlı. Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.<br>Giriş genelde <b>24 saat</b> formatıdır: örn. <b>07:30</b> (AM) veya <b>19:30</b> (PM).`,
        btnStart: "Hesapla",
        btnReset: "Temizle",
        shareBtn: "Paylaş",
        shareTitle: "Paylaş",
        liveTitle: "Şu anki yaşın",
        rYears: "Yıl (yaklaşık)",
        rMonths: "Ay (yaklaşık)",
        rWeeks: "Hafta",
        rDays: "Gün",
        rHours: "Saat",
        rMinutes: "Dakika",
        rSeconds: "Saniye",
        bdayTitle: "Bir sonraki doğum günün",
        bdayLeftLbl: "Doğum gününe kalan süre:",
        bdayWillLbl: "Doğum günün şu gün olacak:",
        bdayHijriLbl: "Hicrî karşılığı:",
        hijriTitle: "Hicrî (Umm al-Qura) yaş",
        hBirthLbl: "Doğum tarihi:",
        hMonthLbl: "Doğum ayı:",
        hAgeLbl: "Yaş:",
        hHint: "Hesaplama Umm al-Qura takvimine göre yapılır.",
        hDiffHint: "Not: Hicrî yıl yaklaşık 354,36 gün, miladî yıl yaklaşık 365,25 gündür. Bu nedenle yılda yaklaşık 11 gün fark oluşur ve zamanla birikir.",
        moreTitle: "Yaşın hakkında daha fazla bilgi",
        bornDayLbl: "Doğduğun gün:",
        bornSeasonLbl: "Doğduğun mevsim:",
        zodiacLbl: "Burcun:",
        sleepLbl: "Sağlıklı uyku:",
        usefulLinks: "Bağlantılar:",
        lnkAbout: "Hakkında",
        lnkPrivacy: "Gizlilik Politikası",
        lnkContact: "İletişim",
        sumAbout: "Hakkında",
        aboutText: "Doğum tarihi ve saatini girerek yaşınızı gerçek zamanlı hesaplayan hafif bir araç. Mobil ve masaüstünde sorunsuz çalışır.",
        sumContact: "İletişim",
        contactIntro: "Öneri veya geri bildirim için şu kanallardan ulaşabilirsiniz:",
        cNameLbl: "İsim:",
        cRoleLbl: "Unvan:",
        cEmailLbl: "E-posta:",
        cLinkedLbl: "LinkedIn:",
        cLinkedText: "Profil",
        alertNeedDate: "Lütfen doğum tarihinizi girin",
        alertInvalid: "Lütfen doğum tarihi/saat değerlerini kontrol edin",
        alertFuture: "Doğum tarihi/saat gelecekte olamaz",
        timeEmpty: `Boş bırakılırsa saat <b>00:00:00</b> kabul edilir.`,
        titleFor: (name) => `${name} için canlı yaş`,
        shareMsg: (hijriBirth) => `Dene! Yaşım burada canlı:\nHicrî karşılığı: ${hijriBirth}`,
        seasons: { winter:"Kış", spring:"İlkbahar", summer:"Yaz", autumn:"Sonbahar" },
        weekday: (date) => new Intl.DateTimeFormat("tr", { weekday:"long" }).format(date),
      }
    };

    const LANG_META = {
      ar: { dir: "rtl", lang: "ar" },
      en: { dir: "ltr", lang: "en" },
      tr: { dir: "ltr", lang: "tr" }
    };

    let currentLang = "ar";

    function pickInitialLanguage(){
      const saved = localStorage.getItem(STORAGE_KEYS.lang);
      if (saved && I18N[saved]) return saved;

      const urlLang = new URLSearchParams(window.location.search).get("lang");
      if (urlLang && I18N[urlLang]) return urlLang;

      const langs = (navigator.languages && navigator.languages.length)
        ? navigator.languages
        : [navigator.language || "en"];

      const lc = langs.map(x => String(x).toLowerCase());
      if (lc.some(x => x.startsWith("ar"))) return "ar";
      if (lc.some(x => x.startsWith("tr"))) return "tr";
      return "en";
    }

    function setLanguage(lang){
      if (!I18N[lang]) lang = "ar";
      currentLang = lang;
      localStorage.setItem(STORAGE_KEYS.lang, lang);

      document.documentElement.lang = LANG_META[lang].lang;
      document.documentElement.dir  = LANG_META[lang].dir;

      const t = I18N[lang];

      $("uiLangLabel").textContent = t.langLabel;

      $("title").textContent = t.titleBase;
      $("subnote").innerHTML = t.subnote;

      $("lblName").textContent = t.lblName;
      $("name").placeholder = t.phName;
      $("hintName").textContent = t.hintName;

      $("lblBirthDate").textContent = t.lblBirthDate;
      $("hintBirthDate").textContent = t.hintBirthDate;

      $("lblBirthTime").textContent = t.lblBirthTime;
      $("hintBirthTime").innerHTML = t.hintBirthTime;

      $("btnStart").textContent = t.btnStart;
      $("btnReset").textContent = t.btnReset;

      $("shareBtnText").textContent = t.shareBtn;
      $("shareModalTitle").textContent = t.shareTitle;

      $("liveTitle").textContent = t.liveTitle;
      $("rYears").textContent = t.rYears;
      $("rMonths").textContent = t.rMonths;
      $("rWeeks").textContent = t.rWeeks;
      $("rDays").textContent = t.rDays;
      $("rHours").textContent = t.rHours;
      $("rMinutes").textContent = t.rMinutes;
      $("rSeconds").textContent = t.rSeconds;

      $("bdayTitle").textContent = t.bdayTitle;
      $("bdayLeftLbl").textContent = t.bdayLeftLbl;
      $("bdayWillLbl").textContent = t.bdayWillLbl;
      $("bdayHijriLbl").textContent = t.bdayHijriLbl;

      $("hTitle").textContent = t.hijriTitle;
      $("hBirthLbl").textContent = t.hBirthLbl;
      $("hMonthLbl").textContent = t.hMonthLbl;
      $("hAgeLbl").textContent = t.hAgeLbl;
      $("hHint").textContent = t.hHint;
      $("hDiffHint").textContent = t.hDiffHint;

      $("moreTitle").textContent = t.moreTitle;
      $("bornDayLbl").textContent = t.bornDayLbl;
      $("bornSeasonLbl").textContent = t.bornSeasonLbl;
      $("zodiacLbl").textContent = t.zodiacLbl;
      $("sleepLbl").textContent = t.sleepLbl;

      $("usefulLinks").textContent = t.usefulLinks;
      $("lnkAbout").textContent = t.lnkAbout;
      $("lnkPrivacy").textContent = t.lnkPrivacy;
      $("lnkContact").textContent = t.lnkContact;

      $("sumAbout").textContent = t.sumAbout;
      $("aboutText").textContent = t.aboutText;

      $("sumContact").textContent = t.sumContact;
      $("contactIntro").textContent = t.contactIntro;

      $("cNameLbl").textContent = t.cNameLbl;
      $("cRoleLbl").textContent = t.cRoleLbl;
      $("cEmailLbl").textContent = t.cEmailLbl;
      $("cLinkedLbl").textContent = t.cLinkedLbl;
      $("cLinkedText").textContent = t.cLinkedText;

      // Update derived UI
      updateTimePreview();
      updateDynamicTitle();
      refreshComputedSections();
    }

    function updateDynamicTitle(){
      const name = ($("name").value || "").trim();
      const t = I18N[currentLang];

      const visible = ($("liveSection").style.display === "block");
      if (!visible){
        $("title").textContent = t.titleBase;
        return;
      }
      $("title").textContent = name ? t.titleFor(name) : t.titleBase;
    }

    function updateTimePreview(){
      const preview = $("timePreview");
      if (!preview) return;

      const t = I18N[currentLang];
      const timeVal = ($("birthTime").value || "").trim();

      if (!timeVal){
        preview.innerHTML = t.timeEmpty;
        return;
      }

      const parts = timeVal.split(":").map(Number);
      const hh24 = parts[0] ?? 0;
      const mm = parts[1] ?? 0;

      const isPM = hh24 >= 12;
      let hh12 = hh24 % 12;
      if (hh12 === 0) hh12 = 12;

      const ampm = isPM ? "PM" : "AM";
      const mm2 = String(mm).padStart(2, "0");
      preview.textContent = `${timeVal} = ${hh12}:${mm2} ${ampm}`;
    }

    // =========================
    // Core app logic
    // =========================
    function buildLocalDate(dateStr, timeStr){
      const parts = (dateStr || "").split("-").map(Number);
      if (parts.length !== 3 || parts.some(Number.isNaN)) return null;

      const t = (timeStr && timeStr.trim()) ? timeStr.trim() : "00:00:00";
      const tParts = t.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mm = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      const y = parts[0], m = parts[1], d = parts[2];
      const dt = new Date(y, m - 1, d, hh, mm, ss);
      if (Number.isNaN(dt.getTime())) return null;
      return dt;
    }

    function resetApp(){
      if (interval) {
        clearInterval(interval);
        interval = null;
      }

      $("liveSection").style.display = "none";
      $("bdaySection").style.display = "none";
      $("hijriSection").style.display = "none";
      $("moreSection").style.display = "none";
      $("shareRow").style.display = "none";

      ["years","months","weeks","days","hours","minutes","seconds"].forEach(id => $(id).textContent = "");

      $("bdayLeftVal").textContent = "";
      $("bdayWillVal").textContent = "";
      $("bdayHijriVal").textContent = "";

      $("hBirthVal").textContent = "";
      $("hMonthVal").textContent = "";
      $("hAgeVal").textContent = "";

      $("bornDayVal").textContent = "";
      $("bornSeasonVal").textContent = "";
      $("zodiacVal").textContent = "";
      $("sleepVal").textContent = "";
      $("moreBadge").textContent = "";

      $("name").value = "";
      $("birthDate").value = "";
      $("birthTime").value = "";

      localStorage.removeItem(STORAGE_KEYS.name);
      localStorage.removeItem(STORAGE_KEYS.date);
      localStorage.removeItem(STORAGE_KEYS.time);

      updateTimePreview();
      setLanguage(currentLang);
    }

    // Hijri-age calculation (month-stepping using Umm al-Qura via Intl)
    function nextHijriMonthSameDay(currentDate, desiredDay){
      // Find first day of next Hijri month by scanning forward
      const startParts = hijriPartsUmmAlQura(currentDate);
      let d = new Date(currentDate.getTime());

      // Move to next day to avoid staying in same month/day
      d.setDate(d.getDate() + 1);

      // Find when hijri day becomes 1 AND month differs from start month
      for (let i=0; i<40; i++){
        const p = hijriPartsUmmAlQura(d);
        if (p.m !== startParts.m && p.d === 1){
          // we are at first day of next hijri month
          // Now determine this month length by finding next month day1
          let monthStart = new Date(d.getTime());
          let monthEndStart = null;
          let e = new Date(d.getTime());
          e.setDate(e.getDate() + 1);
          for (let j=0; j<40; j++){
            const pp = hijriPartsUmmAlQura(e);
            if (pp.m !== p.m && pp.d === 1){
              monthEndStart = new Date(e.getTime());
              break;
            }
            e.setDate(e.getDate() + 1);
          }
          const monthLen = monthEndStart ? Math.round((monthEndStart - monthStart) / 86400000) : 30;
          const clampedDay = Math.min(desiredDay, monthLen);
          const out = new Date(monthStart.getTime());
          out.setDate(out.getDate() + (clampedDay - 1));
          return out;
        }
        d.setDate(d.getDate() + 1);
      }
      return null;
    }

    function computeHijriAge(birthDate, nowDate){
      const b = hijriPartsUmmAlQura(birthDate);
      const desiredDay = b.d || 1;

      let cursor = new Date(birthDate.getTime());
      let months = 0;

      // Count full hijri months until next month would exceed now
      for (let guard=0; guard<2000; guard++){
        const next = nextHijriMonthSameDay(cursor, desiredDay);
        if (!next) break;
        if (next.getTime() <= nowDate.getTime()){
          cursor = next;
          months++;
        } else {
          break;
        }
      }

      const years = Math.floor(months / 12);
      const remMonths = months % 12;

      // Remaining days as actual days between cursor and now
      const remDays = Math.floor((nowDate.getTime() - cursor.getTime()) / 86400000);

      return { years, months: remMonths, days: remDays };
    }

    function formatNumber(n){
      return Number(n).toLocaleString();
    }

    function formatDateTimeTR(date){
      // display as Istanbul time, but without complex tz math in calculations
      return new Intl.DateTimeFormat(currentLang === "ar" ? "ar" : currentLang, {
        timeZone: "Europe/Istanbul",
        weekday:"long",
        year:"numeric", month:"long", day:"numeric",
        hour:"2-digit", minute:"2-digit"
      }).format(date);
    }

    function seasonFromMonth(monthIndex0){
      // Northern hemisphere (Turkey/Syria)
      // Winter: Dec-Feb, Spring: Mar-May, Summer: Jun-Aug, Autumn: Sep-Nov
      const m = monthIndex0 + 1;
      const t = I18N[currentLang];
      if (m === 12 || m === 1 || m === 2) return t.seasons.winter;
      if (m >= 3 && m <= 5) return t.seasons.spring;
      if (m >= 6 && m <= 8) return t.seasons.summer;
      return t.seasons.autumn;
    }

    function zodiacSign(month, day){
      // Western zodiac boundaries
      const signs = {
        ar: ["الجدي","الدلو","الحوت","الحمل","الثور","الجوزاء","السرطان","الأسد","العذراء","الميزان","العقرب","القوس"],
        en: ["Capricorn","Aquarius","Pisces","Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius"],
        tr: ["Oğlak","Kova","Balık","Koç","Boğa","İkizler","Yengeç","Aslan","Başak","Terazi","Akrep","Yay"]
      };
      const s = signs[currentLang] || signs.ar;

      // month/day -> sign
      if ((month==1 && day>=20) || (month==2 && day<=18)) return s[1];
      if ((month==2 && day>=19) || (month==3 && day<=20)) return s[2];
      if ((month==3 && day>=21) || (month==4 && day<=19)) return s[3];
      if ((month==4 && day>=20) || (month==5 && day<=20)) return s[4];
      if ((month==5 && day>=21) || (month==6 && day<=20)) return s[5];
      if ((month==6 && day>=21) || (month==7 && day<=22)) return s[6];
      if ((month==7 && day>=23) || (month==8 && day<=22)) return s[7];
      if ((month==8 && day>=23) || (month==9 && day<=22)) return s[8];
      if ((month==9 && day>=23) || (month==10 && day<=22)) return s[9];
      if ((month==10 && day>=23) || (month==11 && day<=21)) return s[10];
      if ((month==11 && day>=22) || (month==12 && day<=21)) return s[11];
      return s[0]; // Capricorn
    }

    function healthySleepText(ageYears){
      // General guideline text; localized and simple
      if (currentLang === "ar"){
        return (ageYears < 18) ? "الموصى به تقريبًا: 8–10 ساعات" : "الموصى به تقريبًا: 7–9 ساعات";
      }
      if (currentLang === "tr"){
        return (ageYears < 18) ? "Öneri: yaklaşık 8–10 saat" : "Öneri: yaklaşık 7–9 saat";
      }
      return (ageYears < 18) ? "Recommended: ~8–10 hours" : "Recommended: ~7–9 hours";
    }

    function refreshComputedSections(){
      // If results visible, re-render computed text in selected language
      if ($("liveSection").style.display !== "block") return;

      // Re-run non-live calculations
      renderHijriAndMore();
      renderNextBirthday();
    }

    function start(){
      const t = I18N[currentLang];

      const name = ($("name").value || "").trim();
      const date = $("birthDate").value;
      const time = $("birthTime").value || "00:00:00";

      if (!date){
        alert(t.alertNeedDate);
        return;
      }

      const birthDate = buildLocalDate(date, time);
      if (!birthDate){
        alert(t.alertInvalid);
        return;
      }

      if (birthDate.getTime() > Date.now()){
        alert(t.alertFuture);
        return;
      }

      saveInputs();

      $("liveSection").style.display = "block";
      $("bdaySection").style.display = "block";
      $("hijriSection").style.display = "block";
      $("moreSection").style.display = "block";
      $("shareRow").style.display = "flex";

      updateDynamicTitle();

      if (interval) clearInterval(interval);

      function update(){
        const now = Date.now();
        let diffMs = now - birthDate.getTime();
        if (diffMs < 0) diffMs = 0;

        const seconds = Math.floor(diffMs / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours   = Math.floor(minutes / 60);
        const days    = Math.floor(hours / 24);
        const weeks   = Math.floor(days / 7);

        const yearsApprox  = diffMs / (1000 * 60 * 60 * 24 * 365.2425);
        const monthsApprox = yearsApprox * 12;

        $("years").textContent    = yearsApprox.toFixed(6);
        $("months").textContent   = monthsApprox.toFixed(2);
        $("weeks").textContent    = formatNumber(weeks);
        $("days").textContent     = formatNumber(days);
        $("hours").textContent    = formatNumber(hours);
        $("minutes").textContent  = formatNumber(minutes);
        $("seconds").textContent  = formatNumber(seconds);
      }

      update();
      interval = setInterval(update, 1000);

      // Render fixed sections (not per second)
      renderHijriAndMore();
      renderNextBirthday();
      updateShareLink();
    }

    function renderHijriAndMore(){
      const dateStr = $("birthDate").value;
      const timeStr = $("birthTime").value || "00:00:00";
      const birthDate = buildLocalDate(dateStr, timeStr);
      if (!birthDate) return;

      // Hijri birth
      const hb = hijriPartsUmmAlQura(birthDate);
      const months = HIJRI_MONTHS[currentLang] || HIJRI_MONTHS.ar;
      const hbMonthName = months[(hb.m || 1) - 1] || months[0];

      $("hBirthVal").textContent = hijriDateText(birthDate, currentLang);
      $("hMonthVal").textContent = hbMonthName;

      // Hijri age (Umm al-Qura month stepping)
      const now = new Date();
      const ha = computeHijriAge(birthDate, now);

      if (currentLang === "ar"){
        $("hAgeVal").textContent = `${ha.years} سنة و ${ha.months} شهر و ${ha.days} يوم`;
      } else if (currentLang === "tr"){
        $("hAgeVal").textContent = `${ha.years} yıl, ${ha.months} ay, ${ha.days} gün`;
      } else {
        $("hAgeVal").textContent = `${ha.years} years, ${ha.months} months, ${ha.days} days`;
      }

      // More info
      const month = birthDate.getMonth() + 1;
      const day = birthDate.getDate();

      $("bornDayVal").textContent = I18N[currentLang].weekday(birthDate);
      $("bornSeasonVal").textContent = seasonFromMonth(birthDate.getMonth());
      $("zodiacVal").textContent = zodiacSign(month, day);

      // Sleep
      const yearsApprox = (Date.now() - birthDate.getTime()) / (1000*60*60*24*365.2425);
      $("sleepVal").textContent = healthySleepText(Math.floor(yearsApprox));
      $("moreBadge").textContent = ""; // keep clean

      // Keep share link updated with Hijri equivalent
      updateShareLink();
    }

    function renderNextBirthday(){
      const dateStr = $("birthDate").value;
      const timeStr = $("birthTime").value || "00:00:00";
      const birthDate = buildLocalDate(dateStr, timeStr);
      if (!birthDate) return;

      const now = new Date();
      const bMonth = birthDate.getMonth();
      const bDay = birthDate.getDate();

      // Use user's entered time; if empty already set to 00:00:00
      const tParts = timeStr.split(":").map(Number);
      const hh = tParts[0] ?? 0;
      const mm = tParts[1] ?? 0;
      const ss = tParts[2] ?? 0;

      let y = now.getFullYear();
      let next = new Date(y, bMonth, bDay, hh, mm, ss);

      if (next.getTime() <= now.getTime()){
        y += 1;
        next = new Date(y, bMonth, bDay, hh, mm, ss);
      }

      // Countdown (simple and stable)
      let diff = next.getTime() - now.getTime();
      if (diff < 0) diff = 0;

      const totalSeconds = Math.floor(diff / 1000);
      const totalMinutes = Math.floor(totalSeconds / 60);
      const totalHours = Math.floor(totalMinutes / 60);
      const totalDays = Math.floor(totalHours / 24);

      const remHours = totalHours % 24;
      const remMinutes = totalMinutes % 60;
      const remSeconds = totalSeconds % 60;

      // months approximation
      const monthsApprox = Math.floor(totalDays / 30);
      const remDays = totalDays % 30;

      if (currentLang === "ar"){
        $("bdayLeftVal").textContent = `${monthsApprox} شهر و ${remDays} يوم و ${remHours} ساعة و ${remMinutes} دقيقة و ${remSeconds} ثانية`;
      } else if (currentLang === "tr"){
        $("bdayLeftVal").textContent = `${monthsApprox} ay ${remDays} gün ${remHours} saat ${remMinutes} dk ${remSeconds} sn`;
      } else {
        $("bdayLeftVal").textContent = `${monthsApprox} months ${remDays} days ${remHours}h ${remMinutes}m ${remSeconds}s`;
      }

      $("bdayWillVal").textContent = formatDateTimeTR(next);
      $("bdayHijriVal").textContent = hijriDateText(next, currentLang);
    }

    // =========================
    // Share
    // =========================
    function buildShareUrl(){
      const base = "https://tarekja.github.io/";
      const params = new URLSearchParams();
      const n = ($("name").value || "").trim();
      const d = $("birthDate").value || "";
      const t = $("birthTime").value || "";
      if (n) params.set("n", n);
      if (d) params.set("d", d);
      if (t) params.set("t", t);
      params.set("lang", currentLang);

      const qs = params.toString();
      return qs ? (base + "?" + qs) : base;
    }

    function updateShareLink(){
      const url = buildShareUrl();
      $("shareLink").value = url;
    }

    async function shareResult(){
      updateShareLink();

      // build short message as requested (includes Hijri equivalent of birth date)
      const dateStr = $("birthDate").value;
      const timeStr = $("birthTime").value || "00:00:00";
      const birthDate = buildLocalDate(dateStr, timeStr);
      const hijriBirth = birthDate ? hijriDateText(birthDate, currentLang) : "";

      const t = I18N[currentLang];
      const text = t.shareMsg(hijriBirth);
      const url = $("shareLink").value;

      if (navigator.share){
        try{
          await navigator.share({
            title: t.titleBase,
            text: text,
            url: url
          });
          return;
        }catch(e){
          // user canceled or share failed -> fall back
        }
      }
      openShareModal();
    }

    function openShareModal(){
      updateShareLink();
      $("shareToast").textContent = "";
      $("shareModal").classList.add("open");
    }
    function closeShareModal(){
      $("shareModal").classList.remove("open");
    }

    function shareTo(platform){
      const url = encodeURIComponent($("shareLink").value);

      // same short message
      const dateStr = $("birthDate").value;
      const timeStr = $("birthTime").value || "00:00:00";
      const birthDate = buildLocalDate(dateStr, timeStr);
      const hijriBirth = birthDate ? hijriDateText(birthDate, currentLang) : "";

      const msg = encodeURIComponent(I18N[currentLang].shareMsg(hijriBirth));

      let shareUrl = "";
      if (platform === "whatsapp"){
        shareUrl = `https://wa.me/?text=${msg}%0A${url}`;
      } else if (platform === "x"){
        shareUrl = `https://twitter.com/intent/tweet?text=${msg}&url=${url}`;
      } else if (platform === "facebook"){
        // Facebook mainly supports URL; message may be ignored
        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      }
      window.open(shareUrl, "_blank", "noopener,noreferrer");
    }

    async function copyShare(){
      try{
        await navigator.clipboard.writeText($("shareLink").value);
        $("shareToast").textContent = (currentLang === "ar") ? "تم نسخ الرابط." : (currentLang === "tr" ? "Bağlantı kopyalandı." : "Link copied.");
      }catch(e){
        $("shareToast").textContent = (currentLang === "ar") ? "تعذر النسخ، انسخ يدويًا." : (currentLang === "tr" ? "Kopyalanamadı, manuel kopyalayın." : "Copy failed, please copy manually.");
      }
    }

    // =========================
    // URL params support (share link fills inputs)
    // =========================
    function applyUrlParams(){
      const p = new URLSearchParams(window.location.search);
      const n = p.get("n");
      const d = p.get("d");
      const t = p.get("t");
      const l = p.get("lang");

      if (l && I18N[l]){
        currentLang = l;
        $("langSelect").value = l;
        setLanguage(l);
      }

      if (n !== null) $("name").value = n;
      if (d !== null) $("birthDate").value = d;
      if (t !== null) $("birthTime").value = t;
    }

    document.addEventListener("DOMContentLoaded", () => {
      // prevent selecting future date
      const today = new Date().toISOString().split("T")[0];
      $("birthDate").setAttribute("max", today);

      // restore from storage first
      restoreInputs();

      // language init
      currentLang = pickInitialLanguage();
      $("langSelect").value = currentLang;
      setLanguage(currentLang);

      // apply URL params (override)
      applyUrlParams();

      $("langSelect").addEventListener("change", (e) => setLanguage(e.target.value));

      // time preview
      updateTimePreview();
      $("birthTime").addEventListener("input", updateTimePreview);

      // auto-save + title refresh
      ["name","birthDate","birthTime"].forEach(id => {
        $(id).addEventListener("input", () => {
          saveInputs();
          updateDynamicTitle();
          updateShareLink();
        });
      });

      // auto-start if date exists
      if ($("birthDate").value){
        start();
      }
    });
  </script>
</body>
</html>
